<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Roy Francis">
<meta name="description" content="Interactive web applications in R.">

<title>Web apps with Shiny</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/favicon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../assets/images/banner.jpg);
background-size: cover;
      }
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&amp;family=Nunito:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/logos/raukr.png" alt="RaukR logo." class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">HOME</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contents.html" rel="" target="">
 <span class="menu-text">CONTENTS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../program.html" rel="" target="">
 <span class="menu-text">PROGRAM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">ABOUT</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/NBISwe" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Web apps with Shiny</h1>
            <p class="subtitle lead">RaukR 2023 • Advanced R for Bioinformatics</p>
                  <div>
        <div class="description">
          Interactive web applications in R.
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Roy Francis </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">13-Mar-2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ui-layout" id="toc-ui-layout" class="nav-link active" data-scroll-target="#ui-layout"><span class="header-section-number">1</span> UI • Layout</a></li>
  <li><a href="#ui-widgets-input" id="toc-ui-widgets-input" class="nav-link" data-scroll-target="#ui-widgets-input"><span class="header-section-number">2</span> UI • Widgets • Input</a></li>
  <li><a href="#ui-widgets-outputs" id="toc-ui-widgets-outputs" class="nav-link" data-scroll-target="#ui-widgets-outputs"><span class="header-section-number">3</span> UI • Widgets • Outputs</a></li>
  <li><a href="#dynamic-ui" id="toc-dynamic-ui" class="nav-link" data-scroll-target="#dynamic-ui"><span class="header-section-number">4</span> Dynamic UI</a></li>
  <li><a href="#updating-widgets" id="toc-updating-widgets" class="nav-link" data-scroll-target="#updating-widgets"><span class="header-section-number">5</span> Updating widgets</a></li>
  <li><a href="#isolate" id="toc-isolate" class="nav-link" data-scroll-target="#isolate"><span class="header-section-number">6</span> Isolate</a></li>
  <li><a href="#error-validation" id="toc-error-validation" class="nav-link" data-scroll-target="#error-validation"><span class="header-section-number">7</span> Error validation</a></li>
  <li><a href="#download-data" id="toc-download-data" class="nav-link" data-scroll-target="#download-data"><span class="header-section-number">8</span> Download • Data</a></li>
  <li><a href="#download-plot" id="toc-download-plot" class="nav-link" data-scroll-target="#download-plot"><span class="header-section-number">9</span> Download • Plot</a></li>
  <li><a href="#shiny-in-rmarkdown" id="toc-shiny-in-rmarkdown" class="nav-link" data-scroll-target="#shiny-in-rmarkdown"><span class="header-section-number">10</span> Shiny in Rmarkdown</a></li>
  <li><a href="#data-explorer" id="toc-data-explorer" class="nav-link" data-scroll-target="#data-explorer"><span class="header-section-number">11</span> Data explorer</a>
  <ul>
  <li><a href="#ui" id="toc-ui" class="nav-link" data-scroll-target="#ui"><span class="header-section-number">11.1</span> UI</a></li>
  <li><a href="#server" id="toc-server" class="nav-link" data-scroll-target="#server"><span class="header-section-number">11.2</span> Server</a></li>
  </ul></li>
  <li><a href="#rna-seq-power" id="toc-rna-seq-power" class="nav-link" data-scroll-target="#rna-seq-power"><span class="header-section-number">12</span> RNA-Seq power</a>
  <ul>
  <li><a href="#rnaseqpower" id="toc-rnaseqpower" class="nav-link" data-scroll-target="#rnaseqpower"><span class="header-section-number">12.1</span> RNASeqPower</a></li>
  <li><a href="#scaffolding" id="toc-scaffolding" class="nav-link" data-scroll-target="#scaffolding"><span class="header-section-number">12.2</span> Scaffolding</a></li>
  <li><a href="#conditional-ui" id="toc-conditional-ui" class="nav-link" data-scroll-target="#conditional-ui"><span class="header-section-number">12.3</span> Conditional UI</a></li>
  <li><a href="#multiple-numeric-input" id="toc-multiple-numeric-input" class="nav-link" data-scroll-target="#multiple-numeric-input"><span class="header-section-number">12.4</span> Multiple numeric input</a></li>
  <li><a href="#code-cleaning" id="toc-code-cleaning" class="nav-link" data-scroll-target="#code-cleaning"><span class="header-section-number">12.5</span> Code cleaning</a></li>
  <li><a href="#input-validation" id="toc-input-validation" class="nav-link" data-scroll-target="#input-validation"><span class="header-section-number">12.6</span> Input validation</a></li>
  <li><a href="#theme" id="toc-theme" class="nav-link" data-scroll-target="#theme"><span class="header-section-number">12.7</span> Theme</a></li>
  <li><a href="#deployment" id="toc-deployment" class="nav-link" data-scroll-target="#deployment"><span class="header-section-number">12.8</span> Deployment</a></li>
  </ul></li>
  <li><a href="#calendar-app" id="toc-calendar-app" class="nav-link" data-scroll-target="#calendar-app"><span class="header-section-number">13</span> Calendar app</a>
  <ul>
  <li><a href="#creating-the-plot" id="toc-creating-the-plot" class="nav-link" data-scroll-target="#creating-the-plot"><span class="header-section-number">13.1</span> Creating the plot</a></li>
  <li><a href="#building-the-app" id="toc-building-the-app" class="nav-link" data-scroll-target="#building-the-app"><span class="header-section-number">13.2</span> Building the app</a>
  <ul class="collapse">
  <li><a href="#layout" id="toc-layout" class="nav-link" data-scroll-target="#layout"><span class="header-section-number">13.2.1</span> Layout</a></li>
  <li><a href="#ui-1" id="toc-ui-1" class="nav-link" data-scroll-target="#ui-1"><span class="header-section-number">13.2.2</span> UI</a></li>
  <li><a href="#server-1" id="toc-server-1" class="nav-link" data-scroll-target="#server-1"><span class="header-section-number">13.2.3</span> Server</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#nametagger-app" id="toc-nametagger-app" class="nav-link" data-scroll-target="#nametagger-app"><span class="header-section-number">14</span> Nametagger app</a>
  <ul>
  <li><a href="#creating-the-figure" id="toc-creating-the-figure" class="nav-link" data-scroll-target="#creating-the-figure"><span class="header-section-number">14.1</span> Creating the figure</a></li>
  <li><a href="#building-the-app-1" id="toc-building-the-app-1" class="nav-link" data-scroll-target="#building-the-app-1"><span class="header-section-number">14.2</span> Building the app</a>
  <ul class="collapse">
  <li><a href="#ui-2" id="toc-ui-2" class="nav-link" data-scroll-target="#ui-2"><span class="header-section-number">14.2.1</span> UI</a></li>
  <li><a href="#server-2" id="toc-server-2" class="nav-link" data-scroll-target="#server-2"><span class="header-section-number">14.2.2</span> Server</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is an introduction to shiny web applications with R. Please follow the exercise to familiarise yourself with the fundamentals. And then you can follow instructions to build one of the two complete apps.</p>
<ul>
<li>Code chunks starting with <code>shinyApp()</code> can be simply copy-pasted to the RStudio console and run.</li>
<li>Generally, complete shiny code is saved as a text file, named for example, as <strong>app.R</strong> and then clicking <strong>Run app</strong> launches the app.</li>
</ul>
</div>
</div>
<section id="ui-layout" class="level2 page-columns page-full" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="ui-layout"><span class="header-section-number">1</span> UI • Layout</h2>
<p>This is an example to show the layout of widgets on a webpage using shiny functions. <code>fluidPage()</code> is used to define a responsive webpage. <code>titlePanel()</code> is used to define the top bar. <code>sidebarLayout()</code> is used to create a layout that includes a region on the left called side bar panel and a main panel on the right. The contents of these panels are further defined under <code>sidebarPanel()</code> and <code>mainPanel()</code>.</p>
<p>In the main panel, the use of tab panels are demonstrated. The function <code>tabsetPanel()</code> is used to define a tab panel set and individual tabs are defined using <code>tabPanel()</code>. <code>fluidRow()</code> and <code>column()</code> are used to structure elements within each tab. The width of each column is specified. Total width of columns must add up to 12.</p>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">"Title Panel"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">helpText</span>(<span class="st">"Sidebar Panel"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(<span class="fu">tabsetPanel</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="st">"tab1"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">fluidRow</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">column</span>(<span class="dv">6</span>,<span class="fu">helpText</span>(<span class="st">"Col1"</span>)),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">helpText</span>(<span class="st">"Col2"</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">fluidRow</span>(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="st">"background-color:#b0c6fb"</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">helpText</span>(<span class="st">"Col1"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                          ),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="st">"background-color:#ffa153"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">helpText</span>(<span class="st">"Col2"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                          ),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="st">"background-color:#b1f6c6"</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">helpText</span>(<span class="st">"Col3"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="st">"tab2"</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>               <span class="fu">inputPanel</span>(<span class="fu">helpText</span>(<span class="st">"Input Panel"</span>))</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="st">"tab3"</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>               <span class="fu">wellPanel</span>(<span class="fu">helpText</span>(<span class="st">"Well Panel"</span>))</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input,output){}</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui=</span>ui,<span class="at">server=</span>server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-page">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ui-widgets-input" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="ui-widgets-input"><span class="header-section-number">2</span> UI • Widgets • Input</h2>
<p>Input widgets are used to accept content interactively from the user. These widgets usually end in <code>Input</code> like <code>selectInput()</code>. Below are usage examples of several of shiny’s built-in widgets. Every widget has a variable name which is accessible through <code>input$</code> in the server function. For example, the value of a variable named <code>text-input</code> would be accessed through <code>input$text-input</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fileInput</span>(<span class="st">"file-input"</span>,<span class="st">"fileInput:"</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">selectInput</span>(<span class="st">"select-input"</span>,<span class="at">label=</span><span class="st">"selectInput"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>)),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">numericInput</span>(<span class="st">"numeric-input"</span>,<span class="at">label=</span><span class="st">"numericInput"</span>,<span class="at">value=</span><span class="dv">5</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">10</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sliderInput</span>(<span class="st">"slider-input"</span>,<span class="at">label=</span><span class="st">"sliderInput"</span>,<span class="at">value=</span><span class="dv">5</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">10</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">textInput</span>(<span class="st">"text-input"</span>,<span class="at">label=</span><span class="st">"textInput"</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">textAreaInput</span>(<span class="st">"text-area-input"</span>,<span class="at">label=</span><span class="st">"textAreaInput"</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">dateInput</span>(<span class="st">"date-input"</span>,<span class="at">label=</span><span class="st">"dateInput"</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">dateRangeInput</span>(<span class="st">"date-range-input"</span>,<span class="at">label=</span><span class="st">"dateRangeInput"</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">radioButtons</span>(<span class="st">"radio-button"</span>,<span class="at">label=</span><span class="st">"radioButtons"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>),<span class="at">inline=</span>T),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>           <span class="fu">checkboxInput</span>(<span class="st">"checkbox"</span>,<span class="st">"checkboxInput"</span>,<span class="at">value=</span><span class="cn">FALSE</span>),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>           <span class="fu">actionButton</span>(<span class="st">"action-button"</span>,<span class="st">"Action"</span>),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>           <span class="fu">hr</span>(),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>           <span class="fu">submitButton</span>()</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output){},</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="dv">900</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ui-widgets-outputs" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="ui-widgets-outputs"><span class="header-section-number">3</span> UI • Widgets • Outputs</h2>
<p>Similar to input widgets, output widgets are used to display information to the user on the webpage. These widgets usually end in <code>Output</code> like <code>textOutput()</code>. Every widget has a variable name accessible under <code>output$</code> to which content is written in the server function. Render functions are used to write content to output widgets. For example <code>renderText()</code> is used to write text data to <code>textOutput()</code> widget.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(<span class="fu">fluidRow</span>(<span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">textInput</span>(<span class="st">"text_input"</span>,<span class="at">label=</span><span class="st">"textInput"</span>,<span class="at">value=</span><span class="st">"&lt;h3 style='color:red'&gt;Red text&lt;/h3&gt;"</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">hr</span>(),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">htmlOutput</span>(<span class="st">"html_output"</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">textOutput</span>(<span class="st">"text_output"</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">verbatimTextOutput</span>(<span class="st">"verbatim_text_output"</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">tableOutput</span>(<span class="st">"table_output"</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>             <span class="fu">plotOutput</span>(<span class="st">"plot_output"</span>,<span class="at">width=</span><span class="st">"300px"</span>,<span class="at">height=</span><span class="st">"300px"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      ))),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input, output) {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>html_output <span class="ot">&lt;-</span> <span class="fu">renderText</span>({input<span class="sc">$</span>text_input})</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>text_output <span class="ot">&lt;-</span> <span class="fu">renderText</span>({input<span class="sc">$</span>text_input})</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>verbatim_text_output <span class="ot">&lt;-</span> <span class="fu">renderText</span>({input<span class="sc">$</span>text_input})</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>table_output <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]})</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>plot_output <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(iris[,<span class="dv">1</span>],iris[,<span class="dv">2</span>])</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="dv">700</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>In this example, we have a text input box which takes user text and outputs it in three different variations. The first output is html output <code>htmlOutput()</code>. Since the default text is html content, the output is red colored text. A normal non-html text would just look like normal text. The second output is normal text output <code>textOutput()</code>. The third variation is <code>verbatimTextOutput()</code> which displays text in monospaced code style. This example further shows table output and plot output.</p>
</section>
<section id="dynamic-ui" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="dynamic-ui"><span class="header-section-number">4</span> Dynamic UI</h2>
<p>Sometimes we want to add, remove or change currently loaded UI widgets conditionally based on dynamic changes in code execution or user input. Conditional UI can be defined using <code>conditionalPanel()</code>, <code>uiOutput()</code>/<code>renderUI()</code>, <code>insertUI()</code> or <code>removeUI</code>. In this example, we will use <code>uiOutput()</code>/<code>renderUI()</code>.</p>
<p>In the example below, the output plot is displayed only if the selected dataset is <strong>iris</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tableOutput</span>(<span class="st">"table_output"</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uiOutput</span>(<span class="st">"ui"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output) {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({ <span class="fu">get</span>(input<span class="sc">$</span>data_input, <span class="st">'package:datasets'</span>) })</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>ui <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(input<span class="sc">$</span>data_input<span class="sc">==</span><span class="st">"iris"</span>) <span class="fu">plotOutput</span>(<span class="st">"plot_output"</span>,<span class="at">width=</span><span class="st">"400px"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>plot_output <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({<span class="fu">hist</span>(<span class="fu">getdata</span>()[, <span class="dv">1</span>])})</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>table_output <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({<span class="fu">head</span>(<span class="fu">getdata</span>())})</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Here, conditional UI is used to selectively display an output widget (plot). Similarly, this idea can be used to selectively display any input or output widget.</p>
</section>
<section id="updating-widgets" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="updating-widgets"><span class="header-section-number">5</span> Updating widgets</h2>
<p>Widgets can be updated with new values dynamically. <code>observe()</code> and <code>observeEvent()</code> functions can monitor the values of interest and update relevant widgets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"header_input"</span>,<span class="at">label=</span><span class="st">"Select column name"</span>,<span class="at">choices=</span><span class="cn">NULL</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotOutput</span>(<span class="st">"plot_output"</span>,<span class="at">width=</span><span class="st">"400px"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output,session) {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({ <span class="fu">get</span>(input<span class="sc">$</span>data_input, <span class="st">'package:datasets'</span>) })</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>({</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateSelectInput</span>(session,<span class="st">"header_input"</span>,<span class="at">label=</span><span class="st">"Select column name"</span>,<span class="at">choices=</span><span class="fu">colnames</span>(<span class="fu">getdata</span>()))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>plot_output <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#shiny::req(input$header_input)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#validate(need(input$header_input %in% colnames(getdata()),message="Incorrect column name."))</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(<span class="fu">getdata</span>()[, input<span class="sc">$</span>header_input],<span class="at">xlab=</span>input<span class="sc">$</span>header_input,<span class="at">main=</span>input<span class="sc">$</span>data_input)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="dv">600</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>In this example, the user selects a dataset and a column from the selected dataset to be plotted as a histogram. The column name selection widget must automatically update it’s choices depending on the selected dataset. This achieved using <code>observe()</code> where the <code>updateSelectInput()</code> function updates the selection choices. Notice that a third option <code>session</code> is in use in the server function. ie; <code>server=function(input,output,session)</code>. And <code>session</code> is also the first argument in <code>updateSelectInput()</code>. Session keeps track of values in the current session.</p>
<p>When changing the datasets, we can see that there is a short red error message. This is because, after we have selected a new dataset, the old column name from the previous dataset is searched for in the new dataset. This occurs for a short time and causes the error. This can be fixed using careful error handling. We will discuss this in another section.</p>
</section>
<section id="isolate" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="isolate"><span class="header-section-number">6</span> Isolate</h2>
<p>You might’ve noticed that shiny tends to update changes immediately as the input widgets change. This may not be desirable in all circumstances. For example, if the apps runs a heavy calculation, it is more efficient to grab all the changes and execute in one step rather than executing the heavy calculation after every input change. To illustrate this, we have an example below where we plot an image which has the title as input text. Try adding a long title to it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textInput</span>(<span class="st">"in_title"</span>,<span class="at">label=</span><span class="st">"Title"</span>,<span class="at">value=</span><span class="st">"Title"</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotOutput</span>(<span class="st">"out_plot"</span>)),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output) {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(iris[,<span class="dv">1</span>],iris[,<span class="dv">2</span>],<span class="at">main=</span>input<span class="sc">$</span>in_title)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The plot changes as soon as the input text field is changed. And as we type in text, the image is continuously being redrawn. This can be computationally intensive depending on the situation. A better solution would be to write the text completely without any reactivity and when done, let the app know that you are ready to redraw.</p>
<p>We can add an action button such that the plot is changed only when the button is clicked.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textInput</span>(<span class="st">"in_title"</span>,<span class="at">label=</span><span class="st">"Title"</span>,<span class="at">value=</span><span class="st">"Title"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">actionButton</span>(<span class="st">"btn_go"</span>,<span class="st">"Go!"</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotOutput</span>(<span class="st">"out_plot"</span>)),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      input<span class="sc">$</span>btn_go</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(iris[,<span class="dv">1</span>],iris[,<span class="dv">2</span>],<span class="at">main=</span><span class="fu">isolate</span>(input<span class="sc">$</span>in_title))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Now, changes to any of the input fields do not initiate the plot function. The plot is redrawn only when the action button is clicked. When the action button is click, the current values in the input fields are collected and used in the plotting function.</p>
</section>
<section id="error-validation" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="error-validation"><span class="header-section-number">7</span> Error validation</h2>
<p>Shiny returns an error when a variable is NULL, NA or empty. This is similar to normal R operation. The errors show up as bright red text. By using careful error handling, we can print more informative and less distracting error messages. We also have the option of hiding error messages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices=</span><span class="fu">c</span>(<span class="st">""</span>,<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tableOutput</span>(<span class="st">"table_output"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input, output) {</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({ <span class="fu">get</span>(input<span class="sc">$</span>data_input,<span class="st">'package:datasets'</span>) })</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>table_output <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({<span class="fu">head</span>(<span class="fu">getdata</span>())})</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"350px"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>In this example, we have a list of datasets to select which is then printed as a table. The first and default option is an empty string which cannot be printed as a table and therefore returns an error.</p>
<p>We can add an extra line to the above app so that the selected string is validated before running downstream commands in the <code>getdata({})</code> reactive function. The function <code>validate()</code> is used to validate inputs. <code>validate()</code> can be used with <code>need()</code> function or a custom function.</p>
<p>Below we use the <code>need()</code> function to check the input. It checks if the input is NULL, NA or an empty string and returns a specified message if TRUE. <code>try()</code> is optional and is used to catch any other unexpected errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices=</span><span class="fu">c</span>(<span class="st">""</span>,<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tableOutput</span>(<span class="st">"table_output"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input, output) {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(<span class="fu">need</span>(<span class="fu">try</span>(input<span class="sc">$</span>data_input),<span class="st">"Please select a data set"</span>))</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(input<span class="sc">$</span>data_input,<span class="st">'package:datasets'</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>table_output <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({<span class="fu">head</span>(<span class="fu">getdata</span>())})</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"350px"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Now we see an informative gray message (less scary) asking the user to select a dataset.</p>
<p>We can use a custom function instead of using <code>need()</code>. Below, we have created a function called <code>valfun()</code> that checks if the input is NULL, NA or an empty string. This is then used in <code>validate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>valfn <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">is.null</span>(x) <span class="sc">|</span> <span class="fu">is.na</span>(x) <span class="sc">|</span> x<span class="sc">==</span><span class="st">""</span>) <span class="fu">return</span>(<span class="st">"Input data is incorrect."</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices=</span><span class="fu">c</span>(<span class="st">""</span>,<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tableOutput</span>(<span class="st">"table_output"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input, output) {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(<span class="fu">valfn</span>(<span class="fu">try</span>(input<span class="sc">$</span>data_input)))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(input<span class="sc">$</span>data_input,<span class="st">'package:datasets'</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>table_output <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({<span class="fu">head</span>(<span class="fu">getdata</span>())})</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"350px"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The last option is to simple hide the error. This may be used in situations where there is no input needed from the user. We use <code>req()</code> to check if the input is valid, else stop execution there till the condition becomes true.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices=</span><span class="fu">c</span>(<span class="st">""</span>,<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tableOutput</span>(<span class="st">"table_output"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input, output) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">try</span>(input<span class="sc">$</span>data_input))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(input<span class="sc">$</span>data_input,<span class="st">'package:datasets'</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>table_output <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({<span class="fu">head</span>(<span class="fu">getdata</span>())})</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"350px"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>As expected there is no error or any message at all. This is not always the best to use this option as we need the user to do something. An informative message may be better than nothing.</p>
<p>Finally, instead of printing messages about the error or hiding the error, we can try to resolve the errors from the previous section in a more robust manner. <code>shiny::req(input$header_input)</code> is added to ensure that a valid column name string is available before running any of the <code>renderPlot()</code> commands. Second, we add <code>validate(need(input$header_input %in% colnames(getdata()),message="Incorrect column name."))</code> to ensure that the column name is actually a column in the currently selected dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectInput</span>(<span class="st">"header_input"</span>,<span class="at">label=</span><span class="st">"Select column name"</span>,<span class="at">choices=</span><span class="cn">NULL</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotOutput</span>(<span class="st">"plot_output"</span>,<span class="at">width=</span><span class="st">"400px"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output,session) {</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({ <span class="fu">get</span>(input<span class="sc">$</span>data_input, <span class="st">'package:datasets'</span>) })</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>({</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateSelectInput</span>(session,<span class="st">"header_input"</span>,<span class="at">label=</span><span class="st">"Select column name"</span>,<span class="at">choices=</span><span class="fu">colnames</span>(<span class="fu">getdata</span>()))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>plot_output <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>header_input)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(<span class="fu">need</span>(input<span class="sc">$</span>header_input <span class="sc">%in%</span> <span class="fu">colnames</span>(<span class="fu">getdata</span>()),<span class="at">message=</span><span class="st">"Incorrect column name."</span>))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(<span class="fu">getdata</span>()[, input<span class="sc">$</span>header_input],<span class="at">xlab=</span>input<span class="sc">$</span>header_input,<span class="at">main=</span>input<span class="sc">$</span>data_input)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="dv">600</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Now, we do not see any error messages. Note that shiny apps on shinyapps.io do not display the complete regular R error message for security reasons. It returns a generic error message in the app. One needs to inspect the error logs to view the actual error message.</p>
</section>
<section id="download-data" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="download-data"><span class="header-section-number">8</span> Download • Data</h2>
<p>It is often desirable to let the user down data tables and plots as images. This is done using <code>downloadHandler()</code>.</p>
<p>In the example below, we are downloading a table as a csv text file. We define a button that accepts the action input from the user. The <code>downloadHandler()</code> function has the file name argument, and the content argument where we specify the <code>write.csv()</code> command. Note that this example needs to be opened in a browser and may not in the RStudio preview. In the RStudio preview, click on <strong>Open in Browser</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textOutput</span>(<span class="st">"text_output"</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">downloadButton</span>(<span class="st">"button_download"</span>,<span class="st">"Download"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input, output) {</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({ <span class="fu">get</span>(input<span class="sc">$</span>data_input, <span class="st">'package:datasets'</span>) })</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>text_output <span class="ot">&lt;-</span> <span class="fu">renderText</span>(<span class="fu">paste0</span>(<span class="st">"Selected dataset: "</span>,input<span class="sc">$</span>data_input))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>button_download <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste0</span>(input<span class="sc">$</span>data_input,<span class="st">".csv"</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write.csv</span>(<span class="fu">getdata</span>(),file,<span class="at">row.names=</span><span class="cn">FALSE</span>,<span class="at">quote=</span>F)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"200px"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="download-plot" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="download-plot"><span class="header-section-number">9</span> Download • Plot</h2>
<p>In this next example, we are downloading a plot. In the content part of <code>downloadHandler()</code>, we specify commands to export a PNG image. Note that this example needs to be opened in a browser and may not in the RStudio preview. In the RStudio preview, click on <strong>Open in Browser</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selectInput</span>(<span class="st">"data_input"</span>,<span class="at">label=</span><span class="st">"Select data"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"mtcars"</span>,<span class="st">"faithful"</span>,<span class="st">"iris"</span>)),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textOutput</span>(<span class="st">"text_output"</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotOutput</span>(<span class="st">"plot_output"</span>,<span class="at">height=</span><span class="st">"300px"</span>,<span class="at">width=</span><span class="st">"300px"</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">downloadButton</span>(<span class="st">"button_download"</span>,<span class="st">"Download"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input, output) {</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    getdata <span class="ot">&lt;-</span> <span class="fu">reactive</span>({ <span class="fu">get</span>(input<span class="sc">$</span>data_input, <span class="st">'package:datasets'</span>) })</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>text_output <span class="ot">&lt;-</span> <span class="fu">renderText</span>(<span class="fu">paste0</span>(<span class="st">"Selected dataset: "</span>,input<span class="sc">$</span>data_input))</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>plot_output <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({<span class="fu">hist</span>(<span class="fu">getdata</span>()[,<span class="dv">1</span>])})</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>button_download <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(input<span class="sc">$</span>data_input,<span class="st">".png"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">png</span>(file)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hist</span>(<span class="fu">getdata</span>()[, <span class="dv">1</span>])</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dev.off</span>()</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"500px"</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="shiny-in-rmarkdown" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="shiny-in-rmarkdown"><span class="header-section-number">10</span> Shiny in Rmarkdown</h2>
<p>Shiny interactive widgets can be embedded into Rmarkdown documents. These documents need to be live and can handle interactivity. The important addition is the line <code>runtime: shiny</code> to the YAML matter. Here is an example:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="an">runtime:</span><span class="co"> shiny</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>This is a standard RMarkdown document. Here is some code:</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Sepal.Length,iris<span class="sc">$</span>Petal.Width)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>But, here is an interactive shiny widget.</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="fu">sliderInput</span>(<span class="st">"in_breaks"</span>,<span class="at">label=</span><span class="st">"Breaks:"</span>,<span class="at">min=</span><span class="dv">5</span>,<span class="at">max=</span><span class="dv">50</span>,<span class="at">value=</span><span class="dv">5</span>,<span class="at">step=</span><span class="dv">5</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="fu">renderPlot</span>({{</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(iris<span class="sc">$</span>Sepal.Length,<span class="at">breaks=</span>input<span class="sc">$</span>in_breaks)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>}})</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code can be copied to a new file in RStudio and saved as, for example, <strong>shiny.Rmd</strong>. Then click ‘Knit’. Alternatively, you can run <code>rmarkdown::run("shiny.Rmd")</code>.</p>
</section>
<section id="data-explorer" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="data-explorer"><span class="header-section-number">11</span> Data explorer</h2>
<p>A common use case of shiny apps is to explore a dataset interactively. So we will build a simple app that can create a scatterplot from a dataframe which a user can modify interactively. We will use the built-in <code>iris</code> dataset and the user should be able to select x and y axes variables as well the variable mapped to the color of the points.</p>
<p><strong>Topics covered</strong></p>
<ul>
<li>UI sidebar layout</li>
<li>Input and output widgets</li>
<li>Creating plots in a shiny app</li>
<li>Passing variables into ggplot through non standard evaluation</li>
</ul>
<p>Below is a preview of the complete app.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/data-explorer-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="index_files/figure-html/data-explorer-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="ui" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="ui"><span class="header-section-number">11.1</span> UI</h3>
<p>We start with the standard shiny app template.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){}</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then we start building the UI. We will add a title panel and a sidebar layout with a sidebar and a main panel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"Data explorer"</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){}</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>And to the sidebar, we will add 3 input widgets corresponding to x axis variable, y axis variable and color variable. These will be dropdown type (<code>selectInput()</code>) and choices will be column names of the iris dataframe. And we add the output widget (<code>plotOutput()</code>) in the main panel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"Data explorer"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_x"</span>,<span class="st">"X axis variable"</span>, <span class="at">choices=</span><span class="fu">colnames</span>(iris), <span class="at">selected=</span><span class="fu">colnames</span>(iris)[<span class="dv">1</span>], <span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_y"</span>,<span class="st">"Y axis variable"</span>, <span class="at">choices=</span><span class="fu">colnames</span>(iris), <span class="at">selected=</span><span class="fu">colnames</span>(iris)[<span class="dv">2</span>], <span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_col"</span>,<span class="st">"Colour variable"</span>, <span class="at">choices=</span><span class="fu">colnames</span>(iris), <span class="at">selected=</span><span class="fu">colnames</span>(iris)[<span class="dv">3</span>], <span class="at">multiple=</span><span class="cn">FALSE</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plotOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){}</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="server" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="server"><span class="header-section-number">11.2</span> Server</h3>
<p>Now, we need to add the server part. First, we write the ggplot code to create a plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris,<span class="fu">aes</span>(x,y,col))<span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is added inside the output render function <code>renderPlot()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(iris,<span class="fu">aes</span>(x,y,col))<span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We need to wire the input variable into the ggplot inputs x, y and col.&nbsp;This is achieved through <code>input$</code> and the variables are wrapped inside <code>!!sym()</code> to convert quoted text to unquoted variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(iris,<span class="fu">aes</span>(<span class="sc">!!</span><span class="fu">sym</span>(input<span class="sc">$</span>in_x),<span class="at">y=</span><span class="sc">!!</span><span class="fu">sym</span>(input<span class="sc">$</span>in_y),<span class="at">col=</span><span class="sc">!!</span><span class="fu">sym</span>(input<span class="sc">$</span>in_col)))<span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is finally added to the server function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"Data explorer"</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_x"</span>,<span class="st">"X axis variable"</span>, <span class="at">choices=</span><span class="fu">colnames</span>(iris), <span class="at">selected=</span><span class="fu">colnames</span>(iris)[<span class="dv">1</span>], <span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_y"</span>,<span class="st">"Y axis variable"</span>, <span class="at">choices=</span><span class="fu">colnames</span>(iris), <span class="at">selected=</span><span class="fu">colnames</span>(iris)[<span class="dv">2</span>], <span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_col"</span>,<span class="st">"Colour variable"</span>, <span class="at">choices=</span><span class="fu">colnames</span>(iris), <span class="at">selected=</span><span class="fu">colnames</span>(iris)[<span class="dv">3</span>], <span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plotOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(iris,<span class="fu">aes</span>(<span class="sc">!!</span><span class="fu">sym</span>(input<span class="sc">$</span>in_x),<span class="at">y=</span><span class="sc">!!</span><span class="fu">sym</span>(input<span class="sc">$</span>in_y),<span class="at">col=</span><span class="sc">!!</span><span class="fu">sym</span>(input<span class="sc">$</span>in_col)))<span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"500px"</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/data-explorer-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="index_files/figure-html/data-explorer-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>This was a quick and easy start to shiny apps. You can expand this app to other datasets and map more variables to ggplot etc. Can you add the functionality to <a href="https://shiny.rstudio.com/gallery/file-download.html">download the plots</a>? Or perhaps to <a href="https://shiny.rstudio.com/articles/upload.html">upload a csv file</a> and plot from that file?</p>
</section>
</section>
<section id="rna-seq-power" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="rna-seq-power"><span class="header-section-number">12</span> RNA-Seq power</h2>
<p>Run power analysis for an RNA-Seq experiment.</p>
<p><strong>Topics covered</strong></p>
<ul>
<li>UI layout using pre-defined function (pageWithSidebar)</li>
<li>Input and output widgets and reactivity</li>
<li>Conditional widgets based on user input</li>
<li>Validating inputs and custom error messages</li>
<li>Custom theme</li>
</ul>
<p>The following R packages are required for this app: <code>c(shiny, shinythemes)</code>. In addition, install <strong>RNASeqPower</strong> from Bioconductor. <code>BiocManager::install('RNASeqPower')</code>.</p>
<p>Below is a preview of the complete app.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/rnaseq-power-preview.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="assets/rnaseq-power-preview.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<section id="rnaseqpower" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="rnaseqpower"><span class="header-section-number">12.1</span> RNASeqPower</h3>
<p>The R package <strong>RNASeqPower</strong> helps users to perform a power analysis before running an RNA-Seq experiment. It helps you to estimate, for example, the number of samples required to detect a certain level of significance. The idea of this shiny app is to create a GUI for the RNASeqPower package.</p>
<p>So we first need to understand how RNASeqPower works. For a complete understanding, check out <a href="https://bioconductor.org/packages/release/bioc/html/RNASeqPower.html">RNASeqPower</a>. For our purpose, we will take a brief look at how it works. We only need to use one function <code>rnapower()</code>. Check out <code>?RNASeqPower::rnapower</code>.</p>
<p>So, let’s say we want to find out how many samples are required per group. We have some known input parameters. Let’s say the sequencing depth is 50 (<code>depth=50</code>), coefficient of variation is 0.6 (<code>cv=0.6</code>), effect size is 1.5 fold change (<code>effect=1.5</code>), significance cut-off is 0.05 (<code>alpha=0.05</code>) and lastly power of the test is 0.8 (<code>power=0.8</code>). The parameter we want to compute is the number of samples (<code>n</code>), therefore it is not specified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RNASeqPower)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>RNASeqPower<span class="sc">::</span><span class="fu">rnapower</span>(<span class="at">depth=</span><span class="dv">1000</span>,<span class="at">cv=</span><span class="fl">0.6</span>,<span class="at">effect=</span><span class="dv">2</span>,<span class="at">alpha=</span><span class="fl">0.05</span>,<span class="at">power=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.79489</code></pre>
</div>
</div>
<p>And we get the number of samples required given these input conditions.</p>
<p>Similarly, we can estimate any of the other parameters (except <code>depth</code>). We can try another example where we solve for power. What would the power be for a study with 12 samples per group, to detect a 2-fold change, given deep (50x) coverage?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnapower</span>(<span class="at">depth=</span><span class="dv">50</span>, <span class="at">n=</span><span class="dv">12</span>, <span class="at">cv=</span><span class="fl">0.6</span>, <span class="at">effect=</span><span class="dv">2</span>, <span class="at">alpha=</span>.<span class="dv">05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7864965</code></pre>
</div>
</div>
<p>And the function has returned the power.</p>
<p>Now the idea is to create a web application take these input parameters from the user through input widgets.</p>
</section>
<section id="scaffolding" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="scaffolding"><span class="header-section-number">12.2</span> Scaffolding</h3>
<p>Let’s build the basic scaffolding for our app including the input widgets. Let’s assume we are estimating number of samples.</p>
<p>We use a sidebar layout. The input controls go on the sidebar panel and the output goes on the main panel. So we need 5 numeric inputs. We can set some default values as well as reasonable min and max values and steps to increase or decrease. The output will be verbatim text, so we use <code>verbatimTextOutput()</code> widget.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"RNA-Seq | Power analysis"</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">5</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">10</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>,<span class="at">min=</span><span class="fl">0.01</span>,<span class="at">max=</span><span class="fl">0.1</span>,<span class="at">step=</span><span class="fl">0.01</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">verbatimTextOutput</span>(<span class="st">"out_pa"</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"500px"</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>The app should visually look close to our final end result. Check that the widgets work.</p>
<p>The next step is to wire up the inputs to the <code>rnapower()</code> function and return the result to the output text field.</p>
<p><i class="fa-solid fa-clipboard-list" aria-label="clipboard-list"></i> Try to see if you can get this to work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RNASeqPower)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"RNA-Seq | Power analysis"</span>),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">5</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">10</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>,<span class="at">min=</span><span class="fl">0.01</span>,<span class="at">max=</span><span class="fl">0.1</span>,<span class="at">step=</span><span class="fl">0.01</span>),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">verbatimTextOutput</span>(<span class="st">"out_pa"</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_pa <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rnapower</span>(<span class="at">depth=</span>input<span class="sc">$</span>in_pa_depth, <span class="at">cv=</span>input<span class="sc">$</span>in_pa_cv, </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">effect=</span>input<span class="sc">$</span>in_pa_effect, <span class="at">alpha=</span>input<span class="sc">$</span>in_pa_alpha,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">power=</span>input<span class="sc">$</span>in_pa_power)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>Verify that the inputs and outputs work. One can stop at this point if you only need to compute number of samples. But, we will continue to enhance the app to be able to compute any of the other parameters.</p>
</section>
<section id="conditional-ui" class="level3" data-number="12.3">
<h3 data-number="12.3" class="anchored" data-anchor-id="conditional-ui"><span class="header-section-number">12.3</span> Conditional UI</h3>
<p>The function can estimate not only <strong>sample size</strong>, but <strong>cv</strong>, <strong>effect</strong>, <strong>alpha</strong> or <strong>power</strong>. We should let the user choose what they want to compute. So, we need a selection input widget to enable selection. And the input fields must change depending on the user’s selected choice. The <code>rnapower()</code> function must also use a different set of parameters depending on the selection choice. For conditional logic, you can chain <code>if else</code> statements or use <code>switch()</code>.</p>
<p><i class="fa-solid fa-clipboard-list" aria-label="clipboard-list"></i> Try to add a selection based conditional UI. <code>?selectInput()</code>, <code>?uiOutput()</code>, <code>?renderUI()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RNASeqPower)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"RNA-Seq | Power analysis"</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_pa_est"</span>,<span class="st">"Variable to estimate"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"n"</span>,<span class="st">"cv"</span>,<span class="st">"effect"</span>,<span class="st">"alpha"</span>,<span class="st">"power"</span>),<span class="at">selected=</span><span class="dv">1</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">uiOutput</span>(<span class="st">"ui_pa"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">verbatimTextOutput</span>(<span class="st">"out_pa"</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>ui_pa <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span>(input<span class="sc">$</span>in_pa_est,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"n"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">5</span>),</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">10</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>,<span class="at">min=</span><span class="fl">0.01</span>,<span class="at">max=</span><span class="fl">0.1</span>,<span class="at">step=</span><span class="fl">0.01</span>),</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cv"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">5</span>),</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>,<span class="at">min=</span><span class="dv">3</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">1</span>),</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">10</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>,<span class="at">min=</span><span class="fl">0.01</span>,<span class="at">max=</span><span class="fl">0.1</span>,<span class="at">step=</span><span class="fl">0.01</span>),</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"effect"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">5</span>),</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>,<span class="at">min=</span><span class="dv">3</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">1</span>),</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>,<span class="at">min=</span><span class="fl">0.01</span>,<span class="at">max=</span><span class="fl">0.1</span>,<span class="at">step=</span><span class="fl">0.01</span>),</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>)</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">"alpha"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">5</span>),</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>,<span class="at">min=</span><span class="dv">3</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">1</span>),</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">10</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>      <span class="st">"power"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>,<span class="at">min=</span><span class="dv">1</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">5</span>),</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>,<span class="at">min=</span><span class="dv">3</span>,<span class="at">max=</span><span class="dv">1000</span>,<span class="at">step=</span><span class="dv">1</span>),</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">10</span>,<span class="at">step=</span><span class="fl">0.1</span>),</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>          <span class="fu">numericInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>,<span class="at">min=</span><span class="fl">0.01</span>,<span class="at">max=</span><span class="fl">0.1</span>,<span class="at">step=</span><span class="fl">0.01</span>)</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_pa <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span>(input<span class="sc">$</span>in_pa_est,</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>input<span class="sc">$</span>in_pa_depth, <span class="at">cv=</span>input<span class="sc">$</span>in_pa_cv, </span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>               <span class="at">effect=</span>input<span class="sc">$</span>in_pa_effect, <span class="at">alpha=</span>input<span class="sc">$</span>in_pa_alpha,</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>               <span class="at">power=</span>input<span class="sc">$</span>in_pa_power),</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cv"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>input<span class="sc">$</span>in_pa_depth, <span class="at">n=</span>input<span class="sc">$</span>in_pa_n,</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>               <span class="at">effect=</span>input<span class="sc">$</span>in_pa_effect, <span class="at">alpha=</span>input<span class="sc">$</span>in_pa_alpha,</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>               <span class="at">power=</span>input<span class="sc">$</span>in_pa_power),</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">"effect"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>input<span class="sc">$</span>in_pa_depth, <span class="at">cv=</span>input<span class="sc">$</span>in_pa_cv, </span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>               <span class="at">n=</span>input<span class="sc">$</span>in_pa_n, <span class="at">alpha=</span>input<span class="sc">$</span>in_pa_alpha,</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>               <span class="at">power=</span>input<span class="sc">$</span>in_pa_power),</span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">"alpha"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>input<span class="sc">$</span>in_pa_depth, <span class="at">cv=</span>input<span class="sc">$</span>in_pa_cv, </span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>               <span class="at">effect=</span>input<span class="sc">$</span>in_pa_effect, <span class="at">n=</span>input<span class="sc">$</span>in_pa_n,</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>               <span class="at">power=</span>input<span class="sc">$</span>in_pa_power),</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">"power"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>input<span class="sc">$</span>in_pa_depth, <span class="at">cv=</span>input<span class="sc">$</span>in_pa_cv, </span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>               <span class="at">effect=</span>input<span class="sc">$</span>in_pa_effect, <span class="at">alpha=</span>input<span class="sc">$</span>in_pa_alpha,</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>               <span class="at">n=</span>input<span class="sc">$</span>in_pa_n),</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>Let’s summarize what we have done. In the <strong>ui</strong> part, instead of directly including the <code>rnapower()</code> input variable in the <code>sidebarPanel()</code>, we have added a selection input and a conditional UI output. The content inside the output UI depends on the selection made by the user.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">selectInput</span>(<span class="st">"in_pa_est"</span>, <span class="st">"Variable to estimate"</span>, <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"n"</span>,<span class="st">"cv"</span>,<span class="st">"effect"</span>,<span class="st">"alpha"</span>,<span class="st">"power"</span>), <span class="at">selected=</span><span class="dv">1</span>, <span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">uiOutput</span>(<span class="st">"ui_pa"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now to the server part where we make this all work. All conditional UI elements are inside <code>renderUI({})</code> and we use a conditional logic inside it. And since we are returning multiple input widgets, they are all wrapped inside a <code>div()</code> container.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>ui_pa <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span>(input<span class="sc">$</span>in_pa_est,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"n"</span><span class="ot">=</span><span class="fu">div</span>(),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cv"</span><span class="ot">=</span><span class="fu">div</span>()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <code>renderPrint({})</code> function, we use a similar idea. <code>rnapower()</code> is calculated conditionally based on the user selection.</p>
</section>
<section id="multiple-numeric-input" class="level3" data-number="12.4">
<h3 data-number="12.4" class="anchored" data-anchor-id="multiple-numeric-input"><span class="header-section-number">12.4</span> Multiple numeric input</h3>
<p>Another feature of the <code>rnapower()</code> function that we have not discussed so far is that all the input arguments can take more than one number as input. Or in other words, instead of a single number, it can take a vector of number. For example;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>RNASeqPower<span class="sc">::</span><span class="fu">rnapower</span>(<span class="at">depth=</span><span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">100</span>),<span class="at">cv=</span><span class="fl">0.6</span>,<span class="at">effect=</span><span class="fl">1.5</span>,<span class="at">alpha=</span><span class="fl">0.05</span>,<span class="at">power=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      50      100 
36.28393 35.32909 </code></pre>
</div>
</div>
<p>And it expands the results in various ways.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>RNASeqPower<span class="sc">::</span><span class="fu">rnapower</span>(<span class="at">depth=</span><span class="dv">50</span>,<span class="at">cv=</span><span class="fl">0.6</span>,<span class="at">effect=</span><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">alpha=</span><span class="fl">0.05</span>,<span class="at">power=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1.5         2         3 
36.283928 12.415675  4.942337 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>RNASeqPower<span class="sc">::</span><span class="fu">rnapower</span>(<span class="at">depth=</span><span class="dv">50</span>,<span class="at">cv=</span><span class="fu">c</span>(<span class="fl">0.4</span>,<span class="fl">0.6</span>),<span class="at">effect=</span><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">alpha=</span><span class="fl">0.05</span>,<span class="at">power=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1.5         2        3
0.4 17.18712  5.881109 2.341107
0.6 36.28393 12.415675 4.942337</code></pre>
</div>
</div>
<p>The output expands in a bit unpredictable manner and this is the reason why our output widget type is set to <code>verbatimTextOutput({})</code>. Otherwise, we could have formatted it to perhaps, a neater table.</p>
<p><i class="fa fa-comment"></i> How do we incorporate this into our app interface? Ponder over this and try to come up with solutions.</p>
<p>One way to do it is to accept comma separated values from the user. And then parse that into a vector of numbers. For example;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">"2.5,6"</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,x),<span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.5 6.0</code></pre>
</div>
</div>
<p>Blank space are removed, the string is split by comma into a list of strings, the list is converted to a vector and the strings are coerced to numbers.</p>
<p><i class="fa-solid fa-clipboard-list" aria-label="clipboard-list"></i> Update the app such that all numeric inputs are replaced by text inputs and the server logic is able to parse the strings into numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RNASeqPower)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"RNA-Seq | Power analysis"</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_pa_est"</span>,<span class="st">"Variable to estimate"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"n"</span>,<span class="st">"cv"</span>,<span class="st">"effect"</span>,<span class="st">"alpha"</span>,<span class="st">"power"</span>),<span class="at">selected=</span><span class="dv">1</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">uiOutput</span>(<span class="st">"ui_pa"</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">verbatimTextOutput</span>(<span class="st">"out_pa"</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>ui_pa <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span>(input<span class="sc">$</span>in_pa_est,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"n"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>),</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>),</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>),</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>),</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cv"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>),</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>),</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>),</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>),</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"effect"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>),</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>),</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>),</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>),</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>)</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">"alpha"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>),</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>),</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>),</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>),</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>)</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>      <span class="st">"power"</span><span class="ot">=</span><span class="fu">div</span>(</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>),</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>),</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>),</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>),</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>)</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_pa <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span>(input<span class="sc">$</span>in_pa_est,</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n"</span><span class="ot">=</span>{</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>          depth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_depth),<span class="st">","</span>)))</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>          cv <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_cv),<span class="st">","</span>)))</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>          effect <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_effect),<span class="st">","</span>)))</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>          alpha <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_alpha),<span class="st">","</span>)))</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>          power <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_power),<span class="st">","</span>)))</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power)</span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>          },</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cv"</span><span class="ot">=</span>{</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>          depth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_depth),<span class="st">","</span>)))</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>          n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_n),<span class="st">","</span>)))</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>          effect <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_effect),<span class="st">","</span>)))</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>          alpha <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_alpha),<span class="st">","</span>)))</span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>          power <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_power),<span class="st">","</span>)))</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">n=</span>n, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power)</span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">"effect"</span><span class="ot">=</span>{</span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>          depth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_depth),<span class="st">","</span>)))</span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>          n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_n),<span class="st">","</span>)))</span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>          cv <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_cv),<span class="st">","</span>)))</span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>          alpha <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_alpha),<span class="st">","</span>)))</span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>          power <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_power),<span class="st">","</span>)))</span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">n=</span>n, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power)</span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">"alpha"</span><span class="ot">=</span>{</span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a>          depth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_depth),<span class="st">","</span>)))</span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>          n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_n),<span class="st">","</span>)))</span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a>          cv <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_cv),<span class="st">","</span>)))</span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>          effect <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_effect),<span class="st">","</span>)))</span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>          power <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_power),<span class="st">","</span>)))</span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">n=</span>n, <span class="at">power=</span>power)</span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">"power"</span><span class="ot">=</span>{</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a>          depth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_depth),<span class="st">","</span>)))</span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a>          n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_n),<span class="st">","</span>)))</span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a>          cv <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_cv),<span class="st">","</span>)))</span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>          effect <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_effect),<span class="st">","</span>)))</span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a>          alpha <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_alpha),<span class="st">","</span>)))</span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">n=</span>n)</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-33-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="index_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>To summarize our changes, in the ui part, all <code>numericInput()</code> has been changed to <code>textInput()</code> and in the process we lost the number specific input limits such as min, max, step size etc. In the server part, incoming strings are parsed and split into a vector of numbers, saved to a variable and passed to the <code>rnapower()</code> function. Ensure that the app works without errors and we can progress further.</p>
</section>
<section id="code-cleaning" class="level3" data-number="12.5">
<h3 data-number="12.5" class="anchored" data-anchor-id="code-cleaning"><span class="header-section-number">12.5</span> Code cleaning</h3>
<p>It is good practice to check whether the current code can be cleaned-up/polished or reduced. In this example, <strong>depth</strong> is always needed and could be moved out of the conditional block. Only one variable changes based on user input, but all 5 variables are repeated in each conditional block. There is room for improvement there.</p>
<p><i class="fa-solid fa-clipboard-list" aria-label="clipboard-list"></i> Try to figure out how the code can be reorganized and simplified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RNASeqPower)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"RNA-Seq | Power analysis"</span>),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_pa_est"</span>,<span class="st">"Variable to estimate"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"n"</span>,<span class="st">"cv"</span>,<span class="st">"effect"</span>,<span class="st">"alpha"</span>,<span class="st">"power"</span>),<span class="at">selected=</span><span class="dv">1</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">uiOutput</span>(<span class="st">"ui_pa"</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">verbatimTextOutput</span>(<span class="st">"out_pa"</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>ui_pa <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">textInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">4</span>),</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"n"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">100</span>),</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"cv"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>),</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"effect"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>),</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"alpha"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>),</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"power"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_pa <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>          depth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_depth),<span class="st">","</span>)))</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"n"</span>)  n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_n),<span class="st">","</span>)))</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"cv"</span>) cv <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_cv),<span class="st">","</span>)))</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"effect"</span>) effect <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_effect),<span class="st">","</span>)))</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"alpha"</span>)  alpha <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_alpha),<span class="st">","</span>)))</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"power"</span>)  power <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_power),<span class="st">","</span>)))</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span>(input<span class="sc">$</span>in_pa_est,</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cv"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">n=</span>n, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"effect"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">n=</span>n, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"alpha"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">n=</span>n, <span class="at">power=</span>power),</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"power"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">n=</span>n)</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="index_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>UI and server blocks have been considerably reduced in length by removing redundant code.</p>
</section>
<section id="input-validation" class="level3" data-number="12.6">
<h3 data-number="12.6" class="anchored" data-anchor-id="input-validation"><span class="header-section-number">12.6</span> Input validation</h3>
<p>When we changed numeric inputs to character, we lost the input limits and numeric validation. Regardless of what input you enter, the app tries to proceed with the calculation.</p>
<p><i class="fa-solid fa-clipboard-list" aria-label="clipboard-list"></i> Try entering some unreasonable inputs and see what happens. Try entering random strings, or huge integers for <strong>alpha</strong> etc.</p>
<p>We can bring back input validation manually using <code>validate()</code> functions. This can be used to check if the input conforms to some expected range of values and if not, return a message to the user.</p>
<p>Here are the limits we want to set:</p>
<ul>
<li><code>depth</code>: A numeric</li>
<li><code>n</code>: A numeric</li>
<li><code>cv</code>: A numeric</li>
<li><code>effect</code>: A numeric</li>
<li><code>alpha</code>: A numeric between 0 and 1 excluding 0 and 1</li>
<li><code>power</code>: A numeric between 0 and 1 excluding 0 and 1</li>
</ul>
<p><i class="fa-solid fa-clipboard-list" aria-label="clipboard-list"></i> Try to figure out how to add input validation. <code>?shiny::validate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RNASeqPower)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># returns a message if condition is true</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>fn_validate <span class="ot">&lt;-</span> <span class="cf">function</span>(input,message) <span class="cf">if</span>(input) <span class="fu">print</span>(message)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"RNA-Seq | Power analysis"</span>),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">selectInput</span>(<span class="st">"in_pa_est"</span>,<span class="st">"Variable to estimate"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"n"</span>,<span class="st">"cv"</span>,<span class="st">"effect"</span>,<span class="st">"alpha"</span>,<span class="st">"power"</span>),<span class="at">selected=</span><span class="dv">1</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">uiOutput</span>(<span class="st">"ui_pa"</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">verbatimTextOutput</span>(<span class="st">"out_pa"</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>ui_pa <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">textInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>),</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"n"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>),</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"cv"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>),</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"effect"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>),</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"alpha"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>),</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"power"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>)</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_pa <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>          depth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_depth),<span class="st">","</span>)))</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(depth)),<span class="st">"Sequencing depth must be a numeric."</span>))</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"n"</span>) {</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>            n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_n),<span class="st">","</span>)))       </span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>            <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(n)),<span class="st">"Sample size must be a numeric."</span>))</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"cv"</span>) {</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>            cv <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_cv),<span class="st">","</span>)))</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(cv)),<span class="st">"Coefficient of variation must be a numeric."</span>))</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"effect"</span>) {</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>            effect <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_effect),<span class="st">","</span>)))</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(effect)),<span class="st">"Effect must be a numeric."</span>))</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"alpha"</span>)  {</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>            alpha <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_alpha),<span class="st">","</span>)))</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(alpha)),<span class="st">"Alpha must be a numeric."</span>))</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(alpha<span class="sc">&gt;=</span><span class="dv">1</span><span class="sc">|</span>alpha<span class="sc">&lt;=</span><span class="dv">0</span>),<span class="st">"Alpha must be a numeric between 0 and 1."</span>))</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"power"</span>)  {</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>            power <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_power),<span class="st">","</span>)))</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>            <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(power)),<span class="st">"Power must be a numeric."</span>))</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>            <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(power<span class="sc">&gt;=</span><span class="dv">1</span><span class="sc">|</span>power<span class="sc">&lt;=</span><span class="dv">0</span>),<span class="st">"Power must be a numeric between 0 and 1."</span>))</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span>(input<span class="sc">$</span>in_pa_est,</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cv"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">n=</span>n, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">"effect"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">n=</span>n, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">"alpha"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">n=</span>n, <span class="at">power=</span>power),</span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">"power"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">n=</span>n)</span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-35-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="index_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>We have added <code>validate()</code> to all incoming text to ensure that user input is within reasonable limits.</p>
<p><i class="fa-solid fa-clipboard-list" aria-label="clipboard-list"></i> Test that the validation works by inputting unreasonable inputs such as alphabets, symbols etc into the input fields.</p>
</section>
<section id="theme" class="level3" data-number="12.7">
<h3 data-number="12.7" class="anchored" data-anchor-id="theme"><span class="header-section-number">12.7</span> Theme</h3>
<p>This part is purely cosmetic. We can add a custom theme from R package <code>shinythemes</code> to make our app stand out from the default. The theme is added as an argument to <code>fluidPage()</code> like so <code>fluidPage(theme = shinytheme("spacelab"))</code>.</p>
<p><i class="fa-solid fa-clipboard-list" aria-label="clipboard-list"></i> Try changing the theme and pick one that you like. Check out <code>?shinythemes</code>. The themes can be visualized on <a href="https://bootswatch.com/">Bootswatch</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinythemes)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RNASeqPower)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># returns a message if condition is true</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>fn_validate <span class="ot">&lt;-</span> <span class="cf">function</span>(input,message) <span class="cf">if</span>(input) <span class="fu">print</span>(message)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme=</span><span class="fu">shinytheme</span>(<span class="st">"spacelab"</span>),</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"RNA-Seq | Power analysis"</span>),</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectInput</span>(<span class="st">"in_pa_est"</span>,<span class="st">"Variable to estimate"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"n"</span>,<span class="st">"cv"</span>,<span class="st">"effect"</span>,<span class="st">"alpha"</span>,<span class="st">"power"</span>),<span class="at">selected=</span><span class="dv">1</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">uiOutput</span>(<span class="st">"ui_pa"</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">verbatimTextOutput</span>(<span class="st">"out_pa"</span>)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>ui_pa <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">textInput</span>(<span class="st">"in_pa_depth"</span>,<span class="st">"Sequencing depth"</span>,<span class="at">value=</span><span class="dv">100</span>),</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"n"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_n"</span>,<span class="st">"Sample size"</span>,<span class="at">value=</span><span class="dv">12</span>),</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"cv"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_cv"</span>,<span class="st">"Coefficient of variation"</span>,<span class="at">value=</span><span class="fl">0.4</span>),</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"effect"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_effect"</span>,<span class="st">"Effect"</span>,<span class="at">value=</span><span class="dv">2</span>),</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"alpha"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_alpha"</span>,<span class="st">"Alpha"</span>,<span class="at">value=</span><span class="fl">0.05</span>),</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"power"</span>)  <span class="fu">textInput</span>(<span class="st">"in_pa_power"</span>,<span class="st">"Power"</span>,<span class="at">value=</span><span class="fl">0.8</span>)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_pa <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>        depth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_depth),<span class="st">","</span>)))</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(depth)),<span class="st">"Sequencing depth must be a numeric."</span>))</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"n"</span>) {</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>          n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_n),<span class="st">","</span>)))       </span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>          <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(n)),<span class="st">"Sample size must be a numeric."</span>))</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"cv"</span>) {</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>          cv <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_cv),<span class="st">","</span>)))</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>          <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(cv)),<span class="st">"Coefficient of variation must be a numeric."</span>))</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"effect"</span>) {</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>          effect <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_effect),<span class="st">","</span>)))</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(effect)),<span class="st">"Effect must be a numeric."</span>))</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"alpha"</span>)  {</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>          alpha <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_alpha),<span class="st">","</span>)))</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(alpha)),<span class="st">"Alpha must be a numeric."</span>))</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(alpha<span class="sc">&gt;=</span><span class="dv">1</span><span class="sc">|</span>alpha<span class="sc">&lt;=</span><span class="dv">0</span>),<span class="st">"Alpha must be a numeric between 0 and 1."</span>))</span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(input<span class="sc">$</span>in_pa_est <span class="sc">!=</span> <span class="st">"power"</span>)  {</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>          power <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">""</span>,input<span class="sc">$</span>in_pa_power),<span class="st">","</span>)))</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>          <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(power)),<span class="st">"Power must be a numeric."</span>))</span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a>          <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">any</span>(power<span class="sc">&gt;=</span><span class="dv">1</span><span class="sc">|</span>power<span class="sc">&lt;=</span><span class="dv">0</span>),<span class="st">"Power must be a numeric between 0 and 1."</span>))</span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span>(input<span class="sc">$</span>in_pa_est,</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>               <span class="st">"n"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>               <span class="st">"cv"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">n=</span>n, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a>               <span class="st">"effect"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">n=</span>n, <span class="at">alpha=</span>alpha, <span class="at">power=</span>power),</span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a>               <span class="st">"alpha"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">n=</span>n, <span class="at">power=</span>power),</span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a>               <span class="st">"power"</span><span class="ot">=</span><span class="fu">rnapower</span>(<span class="at">depth=</span>depth, <span class="at">cv=</span>cv, <span class="at">effect=</span>effect, <span class="at">alpha=</span>alpha, <span class="at">n=</span>n)</span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-36-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="index_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>This is the completed app.</p>
</section>
<section id="deployment" class="level3" data-number="12.8">
<h3 data-number="12.8" class="anchored" data-anchor-id="deployment"><span class="header-section-number">12.8</span> Deployment</h3>
<p>You do not necessarily need to do this section. This is just so you know.</p>
<p>The app is now ready to be deployed. If you have an account on <a href="https://www.shinyapps.io/">shinyapps.io</a>, you can quickly deploy this app to your account using the R package <code>rsconnect</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsconnect)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>rsconnect<span class="sc">::</span><span class="fu">setAccountInfo</span>(<span class="at">name=</span><span class="st">"username"</span>, <span class="at">token=</span><span class="st">"KJHF853HG6G59C2F4J7B6"</span>, <span class="at">secret=</span><span class="st">"jhHD7%jdg)62F67G/"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">deployApp</span>(<span class="at">appName=</span><span class="st">"my-awesome-app"</span>,<span class="at">appDir=</span><span class="st">"."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The packages used are automatically detected and are installed on to the instance. If Bioconductor packages give an error during deployment, the repositories need to be explicitly set on your system.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setRepositories</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">graphics=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This completes this app tutorial. Hope you have enjoyed this build and learned something interesting along the way. There are few more example apps below, but that is optional.</p>
</section>
</section>
<section id="calendar-app" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="calendar-app"><span class="header-section-number">13</span> Calendar app</h2>
<p>A shiny app to create a calendar planner plot.</p>
<p><strong>Topics covered</strong></p>
<ul>
<li>UI layout using pre-defined function (pageWithSidebar)</li>
<li>Input and output widgets and reactivity</li>
<li>Use of date-time</li>
<li>Customised ggplot</li>
<li>Download image files</li>
<li>Update inputs using observe</li>
<li>Validating inputs with custom error messages</li>
</ul>
<p>The following R packages will be required for this app: <code>ggplot2, shiny, colourpicker</code>.</p>
<p>Below is a preview of the finished app.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/calendar-preview.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="assets/calendar-preview.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>The idea of this app is to create and display a calendar styled planner. Below is a preview of the expected output.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/calendar_plot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="assets/calendar_plot.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>The image is a plot created in ggplot. X axis showing week numbers, y axis showing weekdays, facet titles showing months and dates are colored by categories. We can split this into two parts. The first part is preparing the code for the core task at hand (ie; generating the plot) and the second part is creating a graphical user interface around it using shiny apps to enable the user to input values and adjust dates, categories, plot parameters etc.</p>
<section id="creating-the-plot" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="creating-the-plot"><span class="header-section-number">13.1</span> Creating the plot</h3>
<p>The first step is to figure out how to create this plot in ggplot. The data will be contained in a data.frame. The data.frame is created based on start and end dates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2023-06-01"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2023-07-05"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>dfr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">date=</span><span class="fu">seq</span>(start_date,end_date,<span class="at">by=</span><span class="dv">1</span>))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dfr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-06-01</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-06-03</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-06-05</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-06</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can add some code to get specific information from these dates such as the day, week, month and numeric date. Finally we</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>day <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%a"</span>),<span class="at">levels=</span><span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Mon"</span>,<span class="st">"Tue"</span>,<span class="st">"Wed"</span>,<span class="st">"Thu"</span>,<span class="st">"Fri"</span>,<span class="st">"Sat"</span>,<span class="st">"Sun"</span>)))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>week <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%V"</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%B"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfr<span class="sc">$</span>month,<span class="at">levels=</span><span class="fu">unique</span>(dfr<span class="sc">$</span>month))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>ddate <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%d"</span>))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dfr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: left;">day</th>
<th style="text-align: left;">week</th>
<th style="text-align: left;">month</th>
<th style="text-align: left;">ddate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-06-01</td>
<td style="text-align: left;">Thu</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">01</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-02</td>
<td style="text-align: left;">Fri</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-06-03</td>
<td style="text-align: left;">Sat</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">03</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-04</td>
<td style="text-align: left;">Sun</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-06-05</td>
<td style="text-align: left;">Mon</td>
<td style="text-align: left;">23</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">05</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-06</td>
<td style="text-align: left;">Tue</td>
<td style="text-align: left;">23</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">06</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Finally, we add a column called track which will hold the categorical information for colouring dates by activity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>track <span class="ot">&lt;-</span> <span class="st">"Available"</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>day<span class="sc">==</span><span class="st">"Sat"</span><span class="sc">|</span>dfr<span class="sc">$</span>day<span class="sc">==</span><span class="st">"Sun"</span>] <span class="ot">&lt;-</span> <span class="st">"Weekend"</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dfr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: left;">day</th>
<th style="text-align: left;">week</th>
<th style="text-align: left;">month</th>
<th style="text-align: left;">ddate</th>
<th style="text-align: left;">track</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-06-01</td>
<td style="text-align: left;">Thu</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">01</td>
<td style="text-align: left;">Available</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-02</td>
<td style="text-align: left;">Fri</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Available</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-06-03</td>
<td style="text-align: left;">Sat</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">03</td>
<td style="text-align: left;">Weekend</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-04</td>
<td style="text-align: left;">Sun</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">04</td>
<td style="text-align: left;">Weekend</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-06-05</td>
<td style="text-align: left;">Mon</td>
<td style="text-align: left;">23</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">05</td>
<td style="text-align: left;">Available</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-06-06</td>
<td style="text-align: left;">Tue</td>
<td style="text-align: left;">23</td>
<td style="text-align: left;">June</td>
<td style="text-align: left;">06</td>
<td style="text-align: left;">Available</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This is enough information to plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfr,<span class="fu">aes</span>(<span class="at">x=</span>week,<span class="at">y=</span>day))<span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>track))<span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>ddate))<span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(<span class="sc">~</span>month,<span class="at">scales=</span><span class="st">"free"</span>,<span class="at">space=</span><span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-42-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="index_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>We can add more activities to the track column. Or in other words, I refer to it as adding more tracks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>date<span class="sc">&gt;=</span><span class="fu">as.Date</span>(<span class="st">"2023-06-13"</span>) <span class="sc">&amp;</span> dfr<span class="sc">$</span>date<span class="sc">&lt;=</span><span class="fu">as.Date</span>(<span class="st">"2023-06-17"</span>)] <span class="ot">&lt;-</span> <span class="st">"RaukR"</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>date<span class="sc">==</span><span class="fu">as.Date</span>(<span class="st">"2023-06-24"</span>)] <span class="ot">&lt;-</span> <span class="st">"Midsummer"</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfr,<span class="fu">aes</span>(<span class="at">x=</span>week,<span class="at">y=</span>day))<span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>track))<span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>ddate))<span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(<span class="sc">~</span>month,<span class="at">scales=</span><span class="st">"free"</span>,<span class="at">space=</span><span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-43-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="index_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Now, we can customize the plot as you prefer. I am modifying the axes labels, changing colors and removing most of the plot elements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>all_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#bebada"</span>,<span class="st">"#fb8072"</span>,<span class="st">"#80b1d3"</span>,<span class="st">"#fdb462"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfr,<span class="fu">aes</span>(<span class="at">x=</span>week,<span class="at">y=</span>day))<span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>track))<span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>ddate))<span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>all_cols)<span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(<span class="sc">~</span>month,<span class="at">scales=</span><span class="st">"free"</span>,<span class="at">space=</span><span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Week"</span>,<span class="at">y=</span><span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid=</span><span class="fu">element_blank</span>(),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.border=</span><span class="fu">element_blank</span>(),</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.ticks=</span><span class="fu">element_blank</span>(),</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">colour=</span><span class="st">"grey30"</span>),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.key.size=</span><span class="fu">unit</span>(<span class="fl">0.3</span>,<span class="st">"cm"</span>),</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.spacing.x=</span><span class="fu">unit</span>(<span class="fl">0.2</span>,<span class="st">"cm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-44-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="index_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Our plot is now ready and we have the code to create this plot. The next step is to build a shiny app around it.</p>
</section>
<section id="building-the-app" class="level3" data-number="13.2">
<h3 data-number="13.2" class="anchored" data-anchor-id="building-the-app"><span class="header-section-number">13.2</span> Building the app</h3>
<section id="layout" class="level4" data-number="13.2.1">
<h4 data-number="13.2.1" class="anchored" data-anchor-id="layout"><span class="header-section-number">13.2.1</span> Layout</h4>
<p>We need to first have a plan for the app page, which UI elements to include and how they will be laid out and structured. My plan is as shown in the preview image.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/calendar-preview.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="assets/calendar-preview.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>There is a horizontal top bar for the title and two columns below. The left column will contain the input widgets and control. The right column will contain the plot output. Since, this is a commonly used layout, it is available as a predefined function in shiny called <code>pageWithSidebar()</code>. It takes three arguments <code>headerPanel</code>, <code>sidebarPanel</code> and <code>mainPanel</code> which is self explanatory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pageWithSidebar</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">headerPanel</span>(),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>())</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output){}</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ui-1" class="level4" data-number="13.2.2">
<h4 data-number="13.2.2" class="anchored" data-anchor-id="ui-1"><span class="header-section-number">13.2.2</span> UI</h4>
<p>Then we fill in the panels with widgets and contents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pageWithSidebar</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">headerPanel</span>(<span class="at">title=</span><span class="st">"Calendar Planner"</span>,<span class="at">windowTitle=</span><span class="st">"Calendar Planner"</span>),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">"Duration"</span>),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_duration_date_start"</span>,<span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_duration_date_end"</span>,<span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>())</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output){},</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"400px"</span>)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>We have defined a part of the side bar panel with a title <strong>Duration</strong>. <code>fluidRow()</code> is an html tag used to create rows. Above, in the side bar panel, a row is defined and two columns are defined inside. Each column is filled with date input widgets for start and end dates. We use the columns here to place date input widgets side by side. To place widgets one below the other, the columns can simply be removed. The default value for the start date is set to current date and the end date is set to current date + 30 days.</p>
<p>Now we add more sections to the side bar panel, namely track input variables and plot settings variables. We also added custom colors. Custom colors can be selected using the input widget <code>colourpicker::colourInput()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">toupper</span>(<span class="fu">c</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#bebada"</span>,<span class="st">"#fb8072"</span>,<span class="st">"#80b1d3"</span>,<span class="st">"#fdb462"</span>,<span class="st">"#b3de69"</span>,<span class="st">"#fccde5"</span>,<span class="st">"#FDBF6F"</span>,<span class="st">"#A6CEE3"</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#56B4E9"</span>,<span class="st">"#B2DF8A"</span>,<span class="st">"#FB9A99"</span>,<span class="st">"#CAB2D6"</span>,<span class="st">"#A9C4E2"</span>,<span class="st">"#79C360"</span>,<span class="st">"#FDB762"</span>,<span class="st">"#9471B4"</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#A4A4A4"</span>,<span class="st">"#fbb4ae"</span>,<span class="st">"#b3cde3"</span>,<span class="st">"#ccebc5"</span>,<span class="st">"#decbe4"</span>,<span class="st">"#fed9a6"</span>,<span class="st">"#ffffcc"</span>,<span class="st">"#e5d8bd"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fddaec"</span>,<span class="st">"#f2f2f2"</span>,<span class="st">"#8dd3c7"</span>,<span class="st">"#d9d9d9"</span>))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pageWithSidebar</span>(</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">headerPanel</span>(<span class="at">title=</span><span class="st">"Calendar Planner"</span>,<span class="at">windowTitle=</span><span class="st">"Calendar Planner"</span>),</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">"Duration"</span>),</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_duration_date_start"</span>,<span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_duration_date_end"</span>,<span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">"Tracks"</span>),</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>              <span class="fu">textInput</span>(<span class="st">"in_track_name_1"</span>,<span class="at">label=</span><span class="st">"Name"</span>,<span class="at">value=</span><span class="st">"Vacation"</span>,<span class="at">placeholder=</span><span class="st">"Vacation"</span>)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_track_date_start_1"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_track_date_end_1"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>              colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_1"</span>,<span class="at">label=</span><span class="st">"Colour"</span>,</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="dv">1</span>])</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>              <span class="fu">textInput</span>(<span class="st">"in_track_name_2"</span>,<span class="at">label=</span><span class="st">"Name"</span>,<span class="at">value=</span><span class="st">"Offline"</span>,<span class="at">placeholder=</span><span class="st">"Offline"</span>)</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_track_date_start_2"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_track_date_end_2"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>              colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_2"</span>,<span class="at">label=</span><span class="st">"Colour"</span>,</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="dv">2</span>])</span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>              colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_available"</span>,<span class="at">label=</span><span class="st">"Track colour (Available)"</span>,</span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="fu">length</span>(cols)<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>              colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_weekend"</span>,<span class="at">label=</span><span class="st">"Track colour (Weekend)"</span>,</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="fu">length</span>(cols)])</span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">"Settings"</span>),</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"in_legend_position"</span>,<span class="at">label=</span><span class="st">"Legend position"</span>,</span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"top"</span>,<span class="st">"right"</span>,<span class="st">"left"</span>,<span class="st">"bottom"</span>),<span class="at">selected=</span><span class="st">"right"</span>,<span class="at">multiple=</span>F),</span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>              <span class="fu">selectInput</span>(<span class="st">"in_legend_justification"</span>,<span class="at">label=</span><span class="st">"Legend justification"</span>,</span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a>                          <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"left"</span>,<span class="st">"right"</span>),<span class="at">selected=</span><span class="st">"right"</span>,<span class="at">multiple=</span>F)</span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a>              <span class="fu">selectInput</span>(<span class="st">"in_legend_direction"</span>,<span class="at">label=</span><span class="st">"Legend direction"</span>,</span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a>                          <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"vertical"</span>,<span class="st">"horizontal"</span>),<span class="at">selected=</span><span class="st">"vertical"</span>,<span class="at">multiple=</span>F)</span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_themefontsize"</span>,<span class="at">label=</span><span class="st">"Theme font size"</span>,<span class="at">value=</span><span class="dv">8</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_datefontsize"</span>,<span class="at">label=</span><span class="st">"Date font size"</span>,<span class="at">value=</span><span class="fl">2.5</span>,<span class="at">step=</span><span class="fl">0.1</span>)</span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_monthfontsize"</span>,<span class="at">label=</span><span class="st">"Month font size"</span>,<span class="at">value=</span><span class="dv">8</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_legendfontsize"</span>,<span class="at">label=</span><span class="st">"Legend font size"</span>,<span class="at">value=</span><span class="dv">5</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb54-91"><a href="#cb54-91" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb54-92"><a href="#cb54-92" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output){}</span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-47-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="index_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/calendar-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="assets/calendar-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>The track start and end dates are by default set to the same as that of duration start and end dates. We will adjust this later. Under the settings section, we have added a few useful plot variables to adjust sizes and spacing of plot elements. They are set to reasonable defaults. These variables will be passed on to the ggplot plotting function.</p>
<p>We can end with column with the download options. Input fields are height, width, resolution and file format. Last we add a button for download.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h3</span>(<span class="st">"Download"</span>),</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">helpText</span>(<span class="st">"Width is automatically calculated based on the number of weeks. File type is only applicable to download and does not change preview."</span>),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">numericInput</span>(<span class="st">"in_height"</span>,<span class="st">"Height (cm)"</span>,<span class="at">step=</span><span class="fl">0.5</span>,<span class="at">value=</span><span class="fl">5.5</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">numericInput</span>(<span class="st">"in_width"</span>,<span class="st">"Width (cm)"</span>,<span class="at">step=</span><span class="fl">0.5</span>,<span class="at">value=</span><span class="cn">NA</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectInput</span>(<span class="st">"in_res"</span>,<span class="st">"Res/DPI"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"200"</span>,<span class="st">"300"</span>,<span class="st">"400"</span>,<span class="st">"500"</span>),<span class="at">selected=</span><span class="st">"200"</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectInput</span>(<span class="st">"in_format"</span>,<span class="st">"File type"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"png"</span>,<span class="st">"tiff"</span>,<span class="st">"jpeg"</span>,<span class="st">"pdf"</span>),<span class="at">selected=</span><span class="st">"png"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>,<span class="at">selectize=</span><span class="cn">TRUE</span>)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="fu">downloadButton</span>(<span class="st">"btn_downloadplot"</span>,<span class="st">"Download Plot"</span>),</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>tags<span class="sc">$</span><span class="fu">hr</span>(),</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="fu">helpText</span>(<span class="st">"RaukR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the main panel, we add the plot output function that will hold the output plot. We also add a slider for image preview scaling and the output image. The idea behind the preview scaling is to allow the user to increase or decrease the size of the plot in the browser without affecting the download size. The part of the UI code to add the preview slider is below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mainPanel</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sliderInput</span>(<span class="st">"in_scale"</span>,<span class="st">"Image preview scale"</span>,<span class="at">min=</span><span class="fl">0.1</span>,<span class="at">max=</span><span class="dv">3</span>,<span class="at">step=</span><span class="fl">0.10</span>,<span class="at">value=</span><span class="dv">1</span>),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">helpText</span>(<span class="st">"Scale only controls preview here and does not affect download."</span>),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imageOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This should now look like this. Some additional styling has been added to divs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load colours</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">toupper</span>(<span class="fu">c</span>(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#bebada"</span>,<span class="st">"#fb8072"</span>,<span class="st">"#80b1d3"</span>,<span class="st">"#fdb462"</span>,<span class="st">"#b3de69"</span>,<span class="st">"#fccde5"</span>,<span class="st">"#FDBF6F"</span>,<span class="st">"#A6CEE3"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#56B4E9"</span>,<span class="st">"#B2DF8A"</span>,<span class="st">"#FB9A99"</span>,<span class="st">"#CAB2D6"</span>,<span class="st">"#A9C4E2"</span>,<span class="st">"#79C360"</span>,<span class="st">"#FDB762"</span>,<span class="st">"#9471B4"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#A4A4A4"</span>,<span class="st">"#fbb4ae"</span>,<span class="st">"#b3cde3"</span>,<span class="st">"#ccebc5"</span>,<span class="st">"#decbe4"</span>,<span class="st">"#fed9a6"</span>,<span class="st">"#ffffcc"</span>,<span class="st">"#e5d8bd"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fddaec"</span>,<span class="st">"#f2f2f2"</span>,<span class="st">"#8dd3c7"</span>,<span class="st">"#d9d9d9"</span>))</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pageWithSidebar</span>(</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">headerPanel</span>(<span class="at">title=</span><span class="st">"Calendar Planner"</span>,<span class="at">windowTitle=</span><span class="st">"Calendar Planner"</span>),</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">h3</span>(<span class="st">"Duration"</span>),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">dateInput</span>(<span class="st">"in_duration_date_start"</span>,<span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">dateInput</span>(<span class="st">"in_duration_date_end"</span>,<span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">h3</span>(<span class="st">"Tracks"</span>),</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px;"</span>),</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">textInput</span>(<span class="st">"in_track_name_1"</span>,<span class="at">label=</span><span class="st">"Name"</span>,<span class="at">value=</span><span class="st">"Vacation"</span>,<span class="at">placeholder=</span><span class="st">"Vacation"</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">dateInput</span>(<span class="st">"in_track_date_start_1"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">dateInput</span>(<span class="st">"in_track_date_end_1"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 3px;"</span>),</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>                 colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_1"</span>,<span class="at">label=</span><span class="st">"Colour"</span>,</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="dv">1</span>])</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px;"</span>),</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">textInput</span>(<span class="st">"in_track_name_2"</span>,<span class="at">label=</span><span class="st">"Name"</span>,<span class="at">value=</span><span class="st">"Offline"</span>,<span class="at">placeholder=</span><span class="st">"Offline"</span>)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">dateInput</span>(<span class="st">"in_track_date_start_2"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">dateInput</span>(<span class="st">"in_track_date_end_2"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 3px;"</span>),</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>                 colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_2"</span>,<span class="at">label=</span><span class="st">"Colour"</span>,</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="dv">2</span>])</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>                 colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_available"</span>,<span class="at">label=</span><span class="st">"Track colour (Available)"</span>,</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="fu">length</span>(cols)<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>                 colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_weekend"</span>,<span class="at">label=</span><span class="st">"Track colour (Weekend)"</span>,</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="fu">length</span>(cols)])</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">h3</span>(<span class="st">"Settings"</span>),</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectInput</span>(<span class="st">"in_legend_position"</span>,<span class="at">label=</span><span class="st">"Legend position"</span>,</span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>                    <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"top"</span>,<span class="st">"right"</span>,<span class="st">"left"</span>,<span class="st">"bottom"</span>),<span class="at">selected=</span><span class="st">"right"</span>,<span class="at">multiple=</span>F),</span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">selectInput</span>(<span class="st">"in_legend_justification"</span>,<span class="at">label=</span><span class="st">"Legend justification"</span>,</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>                             <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"left"</span>,<span class="st">"right"</span>),<span class="at">selected=</span><span class="st">"right"</span>,<span class="at">multiple=</span>F)</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">selectInput</span>(<span class="st">"in_legend_direction"</span>,<span class="at">label=</span><span class="st">"Legend direction"</span>,</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>                             <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"vertical"</span>,<span class="st">"horizontal"</span>),<span class="at">selected=</span><span class="st">"vertical"</span>,<span class="at">multiple=</span>F)</span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">numericInput</span>(<span class="st">"in_themefontsize"</span>,<span class="at">label=</span><span class="st">"Theme font size"</span>,<span class="at">value=</span><span class="dv">8</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">numericInput</span>(<span class="st">"in_datefontsize"</span>,<span class="at">label=</span><span class="st">"Date font size"</span>,<span class="at">value=</span><span class="fl">2.5</span>,<span class="at">step=</span><span class="fl">0.1</span>)</span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">numericInput</span>(<span class="st">"in_monthfontsize"</span>,<span class="at">label=</span><span class="st">"Month font size"</span>,<span class="at">value=</span><span class="dv">8</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">numericInput</span>(<span class="st">"in_legendfontsize"</span>,<span class="at">label=</span><span class="st">"Legend font size"</span>,<span class="at">value=</span><span class="dv">5</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">h3</span>(<span class="st">"Download"</span>),</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>        <span class="fu">helpText</span>(<span class="st">"Width is automatically calculated based on the number of weeks. File type is only applicable to download and does not change preview."</span>),</span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">numericInput</span>(<span class="st">"in_height"</span>,<span class="st">"Height (cm)"</span>,<span class="at">step=</span><span class="fl">0.5</span>,<span class="at">value=</span><span class="fl">5.5</span>)</span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">numericInput</span>(<span class="st">"in_width"</span>,<span class="st">"Width (cm)"</span>,<span class="at">step=</span><span class="fl">0.5</span>,<span class="at">value=</span><span class="cn">NA</span>)</span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">selectInput</span>(<span class="st">"in_res"</span>,<span class="st">"Res/DPI"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"200"</span>,<span class="st">"300"</span>,<span class="st">"400"</span>,<span class="st">"500"</span>),<span class="at">selected=</span><span class="st">"200"</span>)</span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">selectInput</span>(<span class="st">"in_format"</span>,<span class="st">"File type"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"png"</span>,<span class="st">"tiff"</span>,<span class="st">"jpeg"</span>,<span class="st">"pdf"</span>),<span class="at">selected=</span><span class="st">"png"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>,<span class="at">selectize=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a>        <span class="fu">downloadButton</span>(<span class="st">"btn_downloadplot"</span>,<span class="st">"Download Plot"</span>),</span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">hr</span>(),</span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a>        <span class="fu">helpText</span>(<span class="st">"RaukR"</span>)</span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sliderInput</span>(<span class="st">"in_scale"</span>,<span class="st">"Image preview scale"</span>,<span class="at">min=</span><span class="fl">0.1</span>,<span class="at">max=</span><span class="dv">3</span>,<span class="at">step=</span><span class="fl">0.10</span>,<span class="at">value=</span><span class="dv">1</span>),</span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">helpText</span>(<span class="st">"Scale only controls preview here and does not affect download."</span>),</span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">imageOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input,output){}</span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/calendar-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="assets/calendar-3.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="server-1" class="level4" data-number="13.2.3">
<h4 data-number="13.2.3" class="anchored" data-anchor-id="server-1"><span class="header-section-number">13.2.3</span> Server</h4>
<p>We can start adding content into the server function to actually enable functionality.</p>
<p>The server code can be organized into 5 blocks.</p>
<ol type="1">
<li><code>fn_plot()</code>: Reactive function that generates ggplot object</li>
<li>out_plot: Plots the ggplot object</li>
<li><code>fn_downloadplotname()</code>: Function to create download image name</li>
<li><code>fn_downloadplot()</code>: Function to create and download the image</li>
<li><code>btn_downloadplot</code>: Download handler that runs <code>fn_downloadplot</code> on button trigger</li>
<li>observe: Observer that updates input values</li>
</ol>
<p>Here is a flow diagram of how these blocks work.</p>
<pre><code>     1 &gt; [2]
     v
3 &gt; [4] &lt; 5

    {6}</code></pre>
<p>The core block 1 creates the preview plot in block 2. The download handler block 5 calls block 1 to generate the plot which is downloaded using block 4. Block 6 is standalone observer.</p>
<p>Reactive values used across multiple functions can be stored using <code>reactiveValues()</code>. These can be written to or accessed from within a reactive environment.</p>
<pre><code>store &lt;- reactiveValues(week=NULL)</code></pre>
<p>We have our core function <code>fn_plot()</code> (block 1). Inputs are validated and gathered from input widgets. We are using <code>shiny::req()</code> to silently check that necessary input variables are available before running through the function. We use <code>validate()</code> with <code>need()</code> to run some basic sanity checks namely that track names are not duplicated and to ensure that start-dates precede end-dates. Necessary date-time calculations are performed. The calendar plot is created and returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="do">## RFN: fn_plot -----------------------------------------------------------</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="do">## core plotting function, returns a ggplot object</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>fn_plot <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_duration_date_start)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_duration_date_end)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_date_start_1)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_date_end_1)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_name_1)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_colour_1)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_date_start_2)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_date_end_2)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_name_2)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_colour_2)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_legend_position)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_legend_justification)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_legend_direction)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_themefontsize)</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_datefontsize)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_monthfontsize)</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_legendfontsize)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">need</span>(input<span class="sc">$</span>in_track_name_1<span class="sc">!=</span>input<span class="sc">$</span>in_track_name_2,<span class="st">"Duplicate track names are not allowed."</span>))</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">need</span>(<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_start) <span class="sc">&lt;</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_end),<span class="st">"End duration date must be later than start duration date."</span>))</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prepare dates</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  dfr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">date=</span><span class="fu">seq</span>(<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_start),<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_end),<span class="at">by=</span><span class="dv">1</span>))</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>day <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%a"</span>),<span class="at">levels=</span><span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Mon"</span>,<span class="st">"Tue"</span>,<span class="st">"Wed"</span>,<span class="st">"Thu"</span>,<span class="st">"Fri"</span>,<span class="st">"Sat"</span>,<span class="st">"Sun"</span>)))</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>week <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%V"</span>))</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%B"</span>)</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfr<span class="sc">$</span>month,<span class="at">levels=</span><span class="fu">unique</span>(dfr<span class="sc">$</span>month))</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>ddate <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%d"</span>))</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#add tracks</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>track <span class="ot">&lt;-</span> <span class="st">"Available"</span></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>day<span class="sc">==</span><span class="st">"Sat"</span> <span class="sc">|</span> dfr<span class="sc">$</span>day<span class="sc">==</span><span class="st">"Sun"</span>] <span class="ot">&lt;-</span> <span class="st">"Weekend"</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>  temp_start_date_1 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_track_date_start_1)</span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>  temp_end_date_1 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_track_date_end_1)</span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>  temp_track_name_1 <span class="ot">&lt;-</span> input<span class="sc">$</span>in_track_name_1</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>  temp_track_col_1 <span class="ot">&lt;-</span> input<span class="sc">$</span>in_track_colour_1</span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">need</span>(temp_start_date_1 <span class="sc">&lt;</span> temp_end_date_1,<span class="st">"End track duration date must be later than start track duration date."</span>))</span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>date<span class="sc">&gt;=</span>temp_start_date_1 <span class="sc">&amp;</span> dfr<span class="sc">$</span>date<span class="sc">&lt;=</span>temp_end_date_1] <span class="ot">&lt;-</span> temp_track_name_1</span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>  temp_start_date_2 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_track_date_start_2)</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>  temp_end_date_2 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_track_date_end_2)</span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a>  temp_track_name_2 <span class="ot">&lt;-</span> input<span class="sc">$</span>in_track_name_2</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>  temp_track_col_2 <span class="ot">&lt;-</span> input<span class="sc">$</span>in_track_colour_2</span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">need</span>(temp_start_date_2 <span class="sc">&lt;</span> temp_end_date_2,<span class="st">"End track duration date must be later than start track duration date."</span>))</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>date<span class="sc">&gt;=</span>temp_start_date_2 <span class="sc">&amp;</span> dfr<span class="sc">$</span>date<span class="sc">&lt;=</span>temp_end_date_2] <span class="ot">&lt;-</span> temp_track_name_2</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create order factor</span></span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>  fc <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"character"</span>)</span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"Available"</span> <span class="sc">%in%</span> <span class="fu">unique</span>(dfr<span class="sc">$</span>track)) fc <span class="ot">&lt;-</span> <span class="fu">c</span>(fc,<span class="st">"Available"</span>)</span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>  fc <span class="ot">&lt;-</span> <span class="fu">c</span>(fc,temp_track_name_1,temp_track_name_2)</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"Weekend"</span> <span class="sc">%in%</span> <span class="fu">unique</span>(dfr<span class="sc">$</span>track)) fc <span class="ot">&lt;-</span> <span class="fu">c</span>(fc,<span class="st">"Weekend"</span>)</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>track <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfr<span class="sc">$</span>track,<span class="at">levels=</span>fc)</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prepare colours</span></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a>  all_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(input<span class="sc">$</span>in_track_colour_available,temp_track_col_1,temp_track_col_2,input<span class="sc">$</span>in_track_colour_weekend)</span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfr,<span class="fu">aes</span>(<span class="at">x=</span>week,<span class="at">y=</span>day))<span class="sc">+</span></span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>track))<span class="sc">+</span></span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>ddate),<span class="at">size=</span>input<span class="sc">$</span>in_datefontsize)<span class="sc">+</span></span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>all_cols)<span class="sc">+</span></span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span>month,<span class="at">scales=</span><span class="st">"free"</span>,<span class="at">space=</span><span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Week"</span>,<span class="at">y=</span><span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size=</span>input<span class="sc">$</span>in_themefontsize)<span class="sc">+</span></span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">colour=</span><span class="st">"grey30"</span>),</span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">size=</span>input<span class="sc">$</span>in_monthfontsize),</span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position=</span>input<span class="sc">$</span>in_legend_position,</span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.justification=</span>input<span class="sc">$</span>in_legend_justification,</span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.direction=</span>input<span class="sc">$</span>in_legend_direction,</span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span>input<span class="sc">$</span>in_legendfontsize),</span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.size=</span><span class="fu">unit</span>(<span class="fl">0.3</span>,<span class="st">"cm"</span>),</span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.spacing.x=</span><span class="fu">unit</span>(<span class="fl">0.2</span>,<span class="st">"cm"</span>))</span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add number of weeks to reactive value</span></span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a>  store<span class="sc">$</span>week <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(dfr<span class="sc">$</span>week))</span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is the block that generates the output image. Image dimensions and resolution is obtained from input widgets. Default width is computed based on number of weeks. This is why the number of weeks was stored as a reactive value. The plot is exported to the working directly and then displayed in the browser. The scale slider allows the plot preview to be scaled in the browser.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">## OUT: out_plot ------------------------------------------------------------</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="do">## plots figure</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderImage</span>({</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">fn_plot</span>())</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_height)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_res)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_scale)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  height <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_height)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  width <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_width)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_res)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(width)) {</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    width <span class="ot">&lt;-</span> (store<span class="sc">$</span>week<span class="sc">*</span><span class="fl">1.2</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(width <span class="sc">&lt;</span> <span class="fl">4.5</span>) width <span class="ot">&lt;-</span> <span class="fl">4.5</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">fn_plot</span>()</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">"calendar_plot.png"</span>,p,<span class="at">height=</span>height,<span class="at">width=</span>width,<span class="at">units=</span><span class="st">"cm"</span>,<span class="at">dpi=</span>res)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">src=</span><span class="st">"calendar_plot.png"</span>,</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">contentType=</span><span class="st">"image/png"</span>,</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">width=</span><span class="fu">round</span>(((width<span class="sc">*</span>res)<span class="sc">/</span><span class="fl">2.54</span>)<span class="sc">*</span>input<span class="sc">$</span>in_scale,<span class="dv">0</span>),</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">height=</span><span class="fu">round</span>(((height<span class="sc">*</span>res)<span class="sc">/</span><span class="fl">2.54</span>)<span class="sc">*</span>input<span class="sc">$</span>in_scale,<span class="dv">0</span>),</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">alt=</span><span class="st">"calendar_plot"</span>))</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>fn_downloadplotname()</code> function simply generates the output filename depending on the filetype extension.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FN: fn_downloadplotname ----------------------------------------------------</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># creates filename for download plot</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>fn_downloadplotname <span class="ot">&lt;-</span> <span class="cf">function</span>()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">paste0</span>(<span class="st">"calendar_plot."</span>,input<span class="sc">$</span>in_format))</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>fn_downloadplot()</code> function uses <code>fn_plot()</code> to create the image and then export the image.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="do">## FN: fn_downloadplot -------------------------------------------------</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="do">## function to download plot</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>fn_downloadplot <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">fn_plot</span>())</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_height)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_res)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_scale)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  height <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_height)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  width <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_width)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_res)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  format <span class="ot">&lt;-</span> input<span class="sc">$</span>in_format</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(width)) width <span class="ot">&lt;-</span> (store<span class="sc">$</span>week<span class="sc">*</span><span class="dv">1</span>)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">fn_plot</span>()</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(format<span class="sc">==</span><span class="st">"pdf"</span> <span class="sc">|</span> format<span class="sc">==</span><span class="st">"svg"</span>){</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">fn_downloadplotname</span>(),p,<span class="at">height=</span>height,<span class="at">width=</span>width,<span class="at">units=</span><span class="st">"cm"</span>,<span class="at">dpi=</span>res)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#embed_fonts(fn_downloadplotname())</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">fn_downloadplotname</span>(),p,<span class="at">height=</span>height,<span class="at">width=</span>width,<span class="at">units=</span><span class="st">"cm"</span>,<span class="at">dpi=</span>res)</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The download handler then downloads the file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">## DHL: btn_downloadplot ----------------------------------------------------</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="do">## download handler for downloading plot</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>btn_downloadplot <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename=</span>fn_downloadplotname,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">content=</span><span class="cf">function</span>(file) {</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fn_downloadplot</span>()</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.copy</span>(<span class="fu">fn_downloadplotname</span>(),file,<span class="at">overwrite=</span>T)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we have the observer function. The observer continuously monitors change in input widgets of interest (here start and end duration) and updates other widget values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">## OBS: tracks dates ---------------------------------------------------------</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">observe</span>({</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_duration_date_start)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_duration_date_end)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">need</span>(<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_start) <span class="sc">&lt;</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_end),<span class="st">"End duration date must be later than start duration date."</span>))</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create date intervals</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  dseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_start),<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_end),<span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  r1 <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(<span class="fu">cut</span>(dseq,<span class="at">breaks=</span><span class="dv">3</span>)))</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateDateInput</span>(session,<span class="st">"in_track_date_start_1"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">as.Date</span>(r1[<span class="dv">1</span>],<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateDateInput</span>(session,<span class="st">"in_track_date_end_1"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">as.Date</span>(r1[<span class="dv">1</span><span class="sc">+</span><span class="dv">1</span>],<span class="st">"%Y-%m-%d"</span>)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateDateInput</span>(session,<span class="st">"in_track_date_start_2"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">as.Date</span>(r1[<span class="dv">2</span>],<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateDateInput</span>(session,<span class="st">"in_track_date_end_2"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">as.Date</span>(r1[<span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>],<span class="st">"%Y-%m-%d"</span>)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The complete code for the app is as below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load libraries</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colourpicker)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="do">## load colours</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">toupper</span>(<span class="fu">c</span>(</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#bebada"</span>,<span class="st">"#fb8072"</span>,<span class="st">"#80b1d3"</span>,<span class="st">"#fdb462"</span>,<span class="st">"#b3de69"</span>,<span class="st">"#fccde5"</span>,<span class="st">"#FDBF6F"</span>,<span class="st">"#A6CEE3"</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#56B4E9"</span>,<span class="st">"#B2DF8A"</span>,<span class="st">"#FB9A99"</span>,<span class="st">"#CAB2D6"</span>,<span class="st">"#A9C4E2"</span>,<span class="st">"#79C360"</span>,<span class="st">"#FDB762"</span>,<span class="st">"#9471B4"</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#A4A4A4"</span>,<span class="st">"#fbb4ae"</span>,<span class="st">"#b3cde3"</span>,<span class="st">"#ccebc5"</span>,<span class="st">"#decbe4"</span>,<span class="st">"#fed9a6"</span>,<span class="st">"#ffffcc"</span>,<span class="st">"#e5d8bd"</span>,</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fddaec"</span>,<span class="st">"#f2f2f2"</span>,<span class="st">"#8dd3c7"</span>,<span class="st">"#d9d9d9"</span>))</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="co"># UI ---------------------------------------------------------------------------</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pageWithSidebar</span>(</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">headerPanel</span>(<span class="at">title=</span><span class="st">"Calendar Planner"</span>,<span class="at">windowTitle=</span><span class="st">"Calendar Planner"</span>),</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">"Duration"</span>),</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_duration_date_start"</span>,<span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_duration_date_end"</span>,<span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">"Tracks"</span>),</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px;"</span>),</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">textInput</span>(<span class="st">"in_track_name_1"</span>,<span class="at">label=</span><span class="st">"Name"</span>,<span class="at">value=</span><span class="st">"Vacation"</span>,<span class="at">placeholder=</span><span class="st">"Vacation"</span>)</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_track_date_start_1"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_track_date_end_1"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 3px;"</span>),</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>              colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_1"</span>,<span class="at">label=</span><span class="st">"Colour"</span>,</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="dv">1</span>])</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px;"</span>),</span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>              <span class="fu">textInput</span>(<span class="st">"in_track_name_2"</span>,<span class="at">label=</span><span class="st">"Name"</span>,<span class="at">value=</span><span class="st">"Offline"</span>,<span class="at">placeholder=</span><span class="st">"Offline"</span>)</span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_track_date_start_2"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">Sys.time</span>(),<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a>              <span class="fu">dateInput</span>(<span class="st">"in_track_date_end_2"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">Sys.time</span>())<span class="sc">+</span><span class="dv">30</span>,<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 3px;"</span>),</span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a>              colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_2"</span>,<span class="at">label=</span><span class="st">"Colour"</span>,</span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="dv">2</span>])</span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>              colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_available"</span>,<span class="at">label=</span><span class="st">"Track colour (Available)"</span>,</span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="fu">length</span>(cols)<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a>              colourpicker<span class="sc">::</span><span class="fu">colourInput</span>(<span class="st">"in_track_colour_weekend"</span>,<span class="at">label=</span><span class="st">"Track colour (Weekend)"</span>,</span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">palette=</span><span class="st">"limited"</span>,<span class="at">allowedCols=</span>cols,<span class="at">value=</span>cols[<span class="fu">length</span>(cols)])</span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">"Settings"</span>),</span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"in_legend_position"</span>,<span class="at">label=</span><span class="st">"Legend position"</span>,</span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"top"</span>,<span class="st">"right"</span>,<span class="st">"left"</span>,<span class="st">"bottom"</span>),<span class="at">selected=</span><span class="st">"right"</span>,<span class="at">multiple=</span>F),</span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a>              <span class="fu">selectInput</span>(<span class="st">"in_legend_justification"</span>,<span class="at">label=</span><span class="st">"Legend justification"</span>,</span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a>                          <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"left"</span>,<span class="st">"right"</span>),<span class="at">selected=</span><span class="st">"right"</span>,<span class="at">multiple=</span>F)</span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-80"><a href="#cb66-80" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb66-81"><a href="#cb66-81" aria-hidden="true" tabindex="-1"></a>              <span class="fu">selectInput</span>(<span class="st">"in_legend_direction"</span>,<span class="at">label=</span><span class="st">"Legend direction"</span>,</span>
<span id="cb66-82"><a href="#cb66-82" aria-hidden="true" tabindex="-1"></a>                          <span class="at">choices=</span><span class="fu">c</span>(<span class="st">"vertical"</span>,<span class="st">"horizontal"</span>),<span class="at">selected=</span><span class="st">"vertical"</span>,<span class="at">multiple=</span>F)</span>
<span id="cb66-83"><a href="#cb66-83" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-84"><a href="#cb66-84" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-85"><a href="#cb66-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-86"><a href="#cb66-86" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb66-87"><a href="#cb66-87" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_themefontsize"</span>,<span class="at">label=</span><span class="st">"Theme font size"</span>,<span class="at">value=</span><span class="dv">8</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb66-88"><a href="#cb66-88" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-89"><a href="#cb66-89" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb66-90"><a href="#cb66-90" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_datefontsize"</span>,<span class="at">label=</span><span class="st">"Date font size"</span>,<span class="at">value=</span><span class="fl">2.5</span>,<span class="at">step=</span><span class="fl">0.1</span>)</span>
<span id="cb66-91"><a href="#cb66-91" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-92"><a href="#cb66-92" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-93"><a href="#cb66-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-94"><a href="#cb66-94" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb66-95"><a href="#cb66-95" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_monthfontsize"</span>,<span class="at">label=</span><span class="st">"Month font size"</span>,<span class="at">value=</span><span class="dv">8</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb66-96"><a href="#cb66-96" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-97"><a href="#cb66-97" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb66-98"><a href="#cb66-98" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_legendfontsize"</span>,<span class="at">label=</span><span class="st">"Legend font size"</span>,<span class="at">value=</span><span class="dv">5</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb66-99"><a href="#cb66-99" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-100"><a href="#cb66-100" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-101"><a href="#cb66-101" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb66-102"><a href="#cb66-102" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">"Download"</span>),</span>
<span id="cb66-103"><a href="#cb66-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">helpText</span>(<span class="st">"Width is automatically calculated based on the number of weeks. File type is only applicable to download and does not change preview."</span>),</span>
<span id="cb66-104"><a href="#cb66-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-105"><a href="#cb66-105" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb66-106"><a href="#cb66-106" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_height"</span>,<span class="st">"Height (cm)"</span>,<span class="at">step=</span><span class="fl">0.5</span>,<span class="at">value=</span><span class="fl">5.5</span>)</span>
<span id="cb66-107"><a href="#cb66-107" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-108"><a href="#cb66-108" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb66-109"><a href="#cb66-109" aria-hidden="true" tabindex="-1"></a>              <span class="fu">numericInput</span>(<span class="st">"in_width"</span>,<span class="st">"Width (cm)"</span>,<span class="at">step=</span><span class="fl">0.5</span>,<span class="at">value=</span><span class="cn">NA</span>)</span>
<span id="cb66-110"><a href="#cb66-110" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-111"><a href="#cb66-111" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-112"><a href="#cb66-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb66-113"><a href="#cb66-113" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 5px;"</span>),</span>
<span id="cb66-114"><a href="#cb66-114" aria-hidden="true" tabindex="-1"></a>              <span class="fu">selectInput</span>(<span class="st">"in_res"</span>,<span class="st">"Res/DPI"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"200"</span>,<span class="st">"300"</span>,<span class="st">"400"</span>,<span class="st">"500"</span>),<span class="at">selected=</span><span class="st">"200"</span>)</span>
<span id="cb66-115"><a href="#cb66-115" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-116"><a href="#cb66-116" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb66-117"><a href="#cb66-117" aria-hidden="true" tabindex="-1"></a>              <span class="fu">selectInput</span>(<span class="st">"in_format"</span>,<span class="st">"File type"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"png"</span>,<span class="st">"tiff"</span>,<span class="st">"jpeg"</span>,<span class="st">"pdf"</span>),<span class="at">selected=</span><span class="st">"png"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>,<span class="at">selectize=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-118"><a href="#cb66-118" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb66-119"><a href="#cb66-119" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-120"><a href="#cb66-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">downloadButton</span>(<span class="st">"btn_downloadplot"</span>,<span class="st">"Download Plot"</span>),</span>
<span id="cb66-121"><a href="#cb66-121" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">hr</span>(),</span>
<span id="cb66-122"><a href="#cb66-122" aria-hidden="true" tabindex="-1"></a>      <span class="fu">helpText</span>(<span class="st">"RaukR"</span>)</span>
<span id="cb66-123"><a href="#cb66-123" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb66-124"><a href="#cb66-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb66-125"><a href="#cb66-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="st">"in_scale"</span>,<span class="st">"Image preview scale"</span>,<span class="at">min=</span><span class="fl">0.1</span>,<span class="at">max=</span><span class="dv">3</span>,<span class="at">step=</span><span class="fl">0.10</span>,<span class="at">value=</span><span class="dv">1</span>),</span>
<span id="cb66-126"><a href="#cb66-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">helpText</span>(<span class="st">"Scale only controls preview here and does not affect download."</span>),</span>
<span id="cb66-127"><a href="#cb66-127" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb66-128"><a href="#cb66-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">imageOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb66-129"><a href="#cb66-129" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-130"><a href="#cb66-130" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-131"><a href="#cb66-131" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb66-132"><a href="#cb66-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-133"><a href="#cb66-133" aria-hidden="true" tabindex="-1"></a><span class="co"># SERVER -----------------------------------------------------------------------</span></span>
<span id="cb66-134"><a href="#cb66-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-135"><a href="#cb66-135" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb66-136"><a href="#cb66-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-137"><a href="#cb66-137" aria-hidden="true" tabindex="-1"></a>  store <span class="ot">&lt;-</span> <span class="fu">reactiveValues</span>(<span class="at">week=</span><span class="cn">NULL</span>)</span>
<span id="cb66-138"><a href="#cb66-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-139"><a href="#cb66-139" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RFN: fn_plot -----------------------------------------------------------</span></span>
<span id="cb66-140"><a href="#cb66-140" aria-hidden="true" tabindex="-1"></a>  <span class="do">## core plotting function, returns a ggplot object</span></span>
<span id="cb66-141"><a href="#cb66-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-142"><a href="#cb66-142" aria-hidden="true" tabindex="-1"></a>  fn_plot <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb66-143"><a href="#cb66-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-144"><a href="#cb66-144" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_duration_date_start)</span>
<span id="cb66-145"><a href="#cb66-145" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_duration_date_end)</span>
<span id="cb66-146"><a href="#cb66-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-147"><a href="#cb66-147" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_date_start_1)</span>
<span id="cb66-148"><a href="#cb66-148" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_date_end_1)</span>
<span id="cb66-149"><a href="#cb66-149" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_name_1)</span>
<span id="cb66-150"><a href="#cb66-150" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_colour_1)</span>
<span id="cb66-151"><a href="#cb66-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-152"><a href="#cb66-152" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_date_start_2)</span>
<span id="cb66-153"><a href="#cb66-153" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_date_end_2)</span>
<span id="cb66-154"><a href="#cb66-154" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_name_2)</span>
<span id="cb66-155"><a href="#cb66-155" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_track_colour_2)</span>
<span id="cb66-156"><a href="#cb66-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-157"><a href="#cb66-157" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_legend_position)</span>
<span id="cb66-158"><a href="#cb66-158" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_legend_justification)</span>
<span id="cb66-159"><a href="#cb66-159" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_legend_direction)</span>
<span id="cb66-160"><a href="#cb66-160" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_themefontsize)</span>
<span id="cb66-161"><a href="#cb66-161" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_datefontsize)</span>
<span id="cb66-162"><a href="#cb66-162" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_monthfontsize)</span>
<span id="cb66-163"><a href="#cb66-163" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_legendfontsize)</span>
<span id="cb66-164"><a href="#cb66-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-165"><a href="#cb66-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(<span class="fu">need</span>(input<span class="sc">$</span>in_track_name_1<span class="sc">!=</span>input<span class="sc">$</span>in_track_name_2,<span class="st">"Duplicate track names are not allowed."</span>))</span>
<span id="cb66-166"><a href="#cb66-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(<span class="fu">need</span>(<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_start) <span class="sc">&lt;</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_end),<span class="st">"End duration date must be later than start duration date."</span>))</span>
<span id="cb66-167"><a href="#cb66-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-168"><a href="#cb66-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># prepare dates</span></span>
<span id="cb66-169"><a href="#cb66-169" aria-hidden="true" tabindex="-1"></a>    dfr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">date=</span><span class="fu">seq</span>(<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_start),<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_end),<span class="at">by=</span><span class="dv">1</span>))</span>
<span id="cb66-170"><a href="#cb66-170" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>day <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%a"</span>),<span class="at">levels=</span><span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Mon"</span>,<span class="st">"Tue"</span>,<span class="st">"Wed"</span>,<span class="st">"Thu"</span>,<span class="st">"Fri"</span>,<span class="st">"Sat"</span>,<span class="st">"Sun"</span>)))</span>
<span id="cb66-171"><a href="#cb66-171" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>week <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%V"</span>))</span>
<span id="cb66-172"><a href="#cb66-172" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%B"</span>)</span>
<span id="cb66-173"><a href="#cb66-173" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfr<span class="sc">$</span>month,<span class="at">levels=</span><span class="fu">unique</span>(dfr<span class="sc">$</span>month))</span>
<span id="cb66-174"><a href="#cb66-174" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>ddate <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">strftime</span>(dfr<span class="sc">$</span>date,<span class="at">format=</span><span class="st">"%d"</span>))</span>
<span id="cb66-175"><a href="#cb66-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-176"><a href="#cb66-176" aria-hidden="true" tabindex="-1"></a>    <span class="co">#add tracks</span></span>
<span id="cb66-177"><a href="#cb66-177" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>track <span class="ot">&lt;-</span> <span class="st">"Available"</span></span>
<span id="cb66-178"><a href="#cb66-178" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>day<span class="sc">==</span><span class="st">"Sat"</span> <span class="sc">|</span> dfr<span class="sc">$</span>day<span class="sc">==</span><span class="st">"Sun"</span>] <span class="ot">&lt;-</span> <span class="st">"Weekend"</span></span>
<span id="cb66-179"><a href="#cb66-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-180"><a href="#cb66-180" aria-hidden="true" tabindex="-1"></a>    temp_start_date_1 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_track_date_start_1)</span>
<span id="cb66-181"><a href="#cb66-181" aria-hidden="true" tabindex="-1"></a>    temp_end_date_1 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_track_date_end_1)</span>
<span id="cb66-182"><a href="#cb66-182" aria-hidden="true" tabindex="-1"></a>    temp_track_name_1 <span class="ot">&lt;-</span> input<span class="sc">$</span>in_track_name_1</span>
<span id="cb66-183"><a href="#cb66-183" aria-hidden="true" tabindex="-1"></a>    temp_track_col_1 <span class="ot">&lt;-</span> input<span class="sc">$</span>in_track_colour_1</span>
<span id="cb66-184"><a href="#cb66-184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(<span class="fu">need</span>(temp_start_date_1 <span class="sc">&lt;</span> temp_end_date_1,<span class="st">"End track duration date must be later than start track duration date."</span>))</span>
<span id="cb66-185"><a href="#cb66-185" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>date<span class="sc">&gt;=</span>temp_start_date_1 <span class="sc">&amp;</span> dfr<span class="sc">$</span>date<span class="sc">&lt;=</span>temp_end_date_1] <span class="ot">&lt;-</span> temp_track_name_1</span>
<span id="cb66-186"><a href="#cb66-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-187"><a href="#cb66-187" aria-hidden="true" tabindex="-1"></a>    temp_start_date_2 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_track_date_start_2)</span>
<span id="cb66-188"><a href="#cb66-188" aria-hidden="true" tabindex="-1"></a>    temp_end_date_2 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_track_date_end_2)</span>
<span id="cb66-189"><a href="#cb66-189" aria-hidden="true" tabindex="-1"></a>    temp_track_name_2 <span class="ot">&lt;-</span> input<span class="sc">$</span>in_track_name_2</span>
<span id="cb66-190"><a href="#cb66-190" aria-hidden="true" tabindex="-1"></a>    temp_track_col_2 <span class="ot">&lt;-</span> input<span class="sc">$</span>in_track_colour_2</span>
<span id="cb66-191"><a href="#cb66-191" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(<span class="fu">need</span>(temp_start_date_2 <span class="sc">&lt;</span> temp_end_date_2,<span class="st">"End track duration date must be later than start track duration date."</span>))</span>
<span id="cb66-192"><a href="#cb66-192" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>track[dfr<span class="sc">$</span>date<span class="sc">&gt;=</span>temp_start_date_2 <span class="sc">&amp;</span> dfr<span class="sc">$</span>date<span class="sc">&lt;=</span>temp_end_date_2] <span class="ot">&lt;-</span> temp_track_name_2</span>
<span id="cb66-193"><a href="#cb66-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-194"><a href="#cb66-194" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create order factor</span></span>
<span id="cb66-195"><a href="#cb66-195" aria-hidden="true" tabindex="-1"></a>    fc <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"character"</span>)</span>
<span id="cb66-196"><a href="#cb66-196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"Available"</span> <span class="sc">%in%</span> <span class="fu">unique</span>(dfr<span class="sc">$</span>track)) fc <span class="ot">&lt;-</span> <span class="fu">c</span>(fc,<span class="st">"Available"</span>)</span>
<span id="cb66-197"><a href="#cb66-197" aria-hidden="true" tabindex="-1"></a>    fc <span class="ot">&lt;-</span> <span class="fu">c</span>(fc,temp_track_name_1,temp_track_name_2)</span>
<span id="cb66-198"><a href="#cb66-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"Weekend"</span> <span class="sc">%in%</span> <span class="fu">unique</span>(dfr<span class="sc">$</span>track)) fc <span class="ot">&lt;-</span> <span class="fu">c</span>(fc,<span class="st">"Weekend"</span>)</span>
<span id="cb66-199"><a href="#cb66-199" aria-hidden="true" tabindex="-1"></a>    dfr<span class="sc">$</span>track <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfr<span class="sc">$</span>track,<span class="at">levels=</span>fc)</span>
<span id="cb66-200"><a href="#cb66-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-201"><a href="#cb66-201" aria-hidden="true" tabindex="-1"></a>    <span class="co"># prepare colours</span></span>
<span id="cb66-202"><a href="#cb66-202" aria-hidden="true" tabindex="-1"></a>    all_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(input<span class="sc">$</span>in_track_colour_available,temp_track_col_1,temp_track_col_2,input<span class="sc">$</span>in_track_colour_weekend)</span>
<span id="cb66-203"><a href="#cb66-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-204"><a href="#cb66-204" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot</span></span>
<span id="cb66-205"><a href="#cb66-205" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfr,<span class="fu">aes</span>(<span class="at">x=</span>week,<span class="at">y=</span>day))<span class="sc">+</span></span>
<span id="cb66-206"><a href="#cb66-206" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>track))<span class="sc">+</span></span>
<span id="cb66-207"><a href="#cb66-207" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>ddate),<span class="at">size=</span>input<span class="sc">$</span>in_datefontsize)<span class="sc">+</span></span>
<span id="cb66-208"><a href="#cb66-208" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>all_cols)<span class="sc">+</span></span>
<span id="cb66-209"><a href="#cb66-209" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(<span class="sc">~</span>month,<span class="at">scales=</span><span class="st">"free"</span>,<span class="at">space=</span><span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb66-210"><a href="#cb66-210" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Week"</span>,<span class="at">y=</span><span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb66-211"><a href="#cb66-211" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>(<span class="at">base_size=</span>input<span class="sc">$</span>in_themefontsize)<span class="sc">+</span></span>
<span id="cb66-212"><a href="#cb66-212" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb66-213"><a href="#cb66-213" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid=</span><span class="fu">element_blank</span>(),</span>
<span id="cb66-214"><a href="#cb66-214" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.border=</span><span class="fu">element_blank</span>(),</span>
<span id="cb66-215"><a href="#cb66-215" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.ticks=</span><span class="fu">element_blank</span>(),</span>
<span id="cb66-216"><a href="#cb66-216" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">colour=</span><span class="st">"grey30"</span>),</span>
<span id="cb66-217"><a href="#cb66-217" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb66-218"><a href="#cb66-218" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">size=</span>input<span class="sc">$</span>in_monthfontsize),</span>
<span id="cb66-219"><a href="#cb66-219" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position=</span>input<span class="sc">$</span>in_legend_position,</span>
<span id="cb66-220"><a href="#cb66-220" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.justification=</span>input<span class="sc">$</span>in_legend_justification,</span>
<span id="cb66-221"><a href="#cb66-221" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.direction=</span>input<span class="sc">$</span>in_legend_direction,</span>
<span id="cb66-222"><a href="#cb66-222" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span>input<span class="sc">$</span>in_legendfontsize),</span>
<span id="cb66-223"><a href="#cb66-223" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.key.size=</span><span class="fu">unit</span>(<span class="fl">0.3</span>,<span class="st">"cm"</span>),</span>
<span id="cb66-224"><a href="#cb66-224" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.spacing.x=</span><span class="fu">unit</span>(<span class="fl">0.2</span>,<span class="st">"cm"</span>))</span>
<span id="cb66-225"><a href="#cb66-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-226"><a href="#cb66-226" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add number of weeks to reactive value</span></span>
<span id="cb66-227"><a href="#cb66-227" aria-hidden="true" tabindex="-1"></a>    store<span class="sc">$</span>week <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(dfr<span class="sc">$</span>week))</span>
<span id="cb66-228"><a href="#cb66-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-229"><a href="#cb66-229" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb66-230"><a href="#cb66-230" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb66-231"><a href="#cb66-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-232"><a href="#cb66-232" aria-hidden="true" tabindex="-1"></a>  <span class="do">## OUT: out_plot ------------------------------------------------------------</span></span>
<span id="cb66-233"><a href="#cb66-233" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plots figure</span></span>
<span id="cb66-234"><a href="#cb66-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-235"><a href="#cb66-235" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderImage</span>({</span>
<span id="cb66-236"><a href="#cb66-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-237"><a href="#cb66-237" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">fn_plot</span>())</span>
<span id="cb66-238"><a href="#cb66-238" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_height)</span>
<span id="cb66-239"><a href="#cb66-239" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_res)</span>
<span id="cb66-240"><a href="#cb66-240" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_scale)</span>
<span id="cb66-241"><a href="#cb66-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-242"><a href="#cb66-242" aria-hidden="true" tabindex="-1"></a>    height <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_height)</span>
<span id="cb66-243"><a href="#cb66-243" aria-hidden="true" tabindex="-1"></a>    width <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_width)</span>
<span id="cb66-244"><a href="#cb66-244" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_res)</span>
<span id="cb66-245"><a href="#cb66-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-246"><a href="#cb66-246" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(width)) {</span>
<span id="cb66-247"><a href="#cb66-247" aria-hidden="true" tabindex="-1"></a>      width <span class="ot">&lt;-</span> (store<span class="sc">$</span>week<span class="sc">*</span><span class="fl">1.2</span>)</span>
<span id="cb66-248"><a href="#cb66-248" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(width <span class="sc">&lt;</span> <span class="fl">4.5</span>) width <span class="ot">&lt;-</span> <span class="fl">4.5</span></span>
<span id="cb66-249"><a href="#cb66-249" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-250"><a href="#cb66-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-251"><a href="#cb66-251" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">fn_plot</span>()</span>
<span id="cb66-252"><a href="#cb66-252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="st">"calendar_plot.png"</span>,p,<span class="at">height=</span>height,<span class="at">width=</span>width,<span class="at">units=</span><span class="st">"cm"</span>,<span class="at">dpi=</span>res)</span>
<span id="cb66-253"><a href="#cb66-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-254"><a href="#cb66-254" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">src=</span><span class="st">"calendar_plot.png"</span>,</span>
<span id="cb66-255"><a href="#cb66-255" aria-hidden="true" tabindex="-1"></a>                <span class="at">contentType=</span><span class="st">"image/png"</span>,</span>
<span id="cb66-256"><a href="#cb66-256" aria-hidden="true" tabindex="-1"></a>                <span class="at">width=</span><span class="fu">round</span>(((width<span class="sc">*</span>res)<span class="sc">/</span><span class="fl">2.54</span>)<span class="sc">*</span>input<span class="sc">$</span>in_scale,<span class="dv">0</span>),</span>
<span id="cb66-257"><a href="#cb66-257" aria-hidden="true" tabindex="-1"></a>                <span class="at">height=</span><span class="fu">round</span>(((height<span class="sc">*</span>res)<span class="sc">/</span><span class="fl">2.54</span>)<span class="sc">*</span>input<span class="sc">$</span>in_scale,<span class="dv">0</span>),</span>
<span id="cb66-258"><a href="#cb66-258" aria-hidden="true" tabindex="-1"></a>                <span class="at">alt=</span><span class="st">"calendar_plot"</span>))</span>
<span id="cb66-259"><a href="#cb66-259" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb66-260"><a href="#cb66-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-261"><a href="#cb66-261" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FN: fn_downloadplotname ----------------------------------------------------</span></span>
<span id="cb66-262"><a href="#cb66-262" aria-hidden="true" tabindex="-1"></a>  <span class="co"># creates filename for download plot</span></span>
<span id="cb66-263"><a href="#cb66-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-264"><a href="#cb66-264" aria-hidden="true" tabindex="-1"></a>  fn_downloadplotname <span class="ot">&lt;-</span> <span class="cf">function</span>()</span>
<span id="cb66-265"><a href="#cb66-265" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb66-266"><a href="#cb66-266" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">paste0</span>(<span class="st">"calendar_plot."</span>,input<span class="sc">$</span>in_format))</span>
<span id="cb66-267"><a href="#cb66-267" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-268"><a href="#cb66-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-269"><a href="#cb66-269" aria-hidden="true" tabindex="-1"></a>  <span class="do">## FN: fn_downloadplot -------------------------------------------------</span></span>
<span id="cb66-270"><a href="#cb66-270" aria-hidden="true" tabindex="-1"></a>  <span class="do">## function to download plot</span></span>
<span id="cb66-271"><a href="#cb66-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-272"><a href="#cb66-272" aria-hidden="true" tabindex="-1"></a>  fn_downloadplot <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb66-273"><a href="#cb66-273" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">fn_plot</span>())</span>
<span id="cb66-274"><a href="#cb66-274" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_height)</span>
<span id="cb66-275"><a href="#cb66-275" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_res)</span>
<span id="cb66-276"><a href="#cb66-276" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_scale)</span>
<span id="cb66-277"><a href="#cb66-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-278"><a href="#cb66-278" aria-hidden="true" tabindex="-1"></a>    height <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_height)</span>
<span id="cb66-279"><a href="#cb66-279" aria-hidden="true" tabindex="-1"></a>    width <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_width)</span>
<span id="cb66-280"><a href="#cb66-280" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(input<span class="sc">$</span>in_res)</span>
<span id="cb66-281"><a href="#cb66-281" aria-hidden="true" tabindex="-1"></a>    format <span class="ot">&lt;-</span> input<span class="sc">$</span>in_format</span>
<span id="cb66-282"><a href="#cb66-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-283"><a href="#cb66-283" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(width)) width <span class="ot">&lt;-</span> (store<span class="sc">$</span>week<span class="sc">*</span><span class="dv">1</span>)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb66-284"><a href="#cb66-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-285"><a href="#cb66-285" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">fn_plot</span>()</span>
<span id="cb66-286"><a href="#cb66-286" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(format<span class="sc">==</span><span class="st">"pdf"</span> <span class="sc">|</span> format<span class="sc">==</span><span class="st">"svg"</span>){</span>
<span id="cb66-287"><a href="#cb66-287" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="fu">fn_downloadplotname</span>(),p,<span class="at">height=</span>height,<span class="at">width=</span>width,<span class="at">units=</span><span class="st">"cm"</span>,<span class="at">dpi=</span>res)</span>
<span id="cb66-288"><a href="#cb66-288" aria-hidden="true" tabindex="-1"></a>      <span class="co">#embed_fonts(fn_downloadplotname())</span></span>
<span id="cb66-289"><a href="#cb66-289" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb66-290"><a href="#cb66-290" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="fu">fn_downloadplotname</span>(),p,<span class="at">height=</span>height,<span class="at">width=</span>width,<span class="at">units=</span><span class="st">"cm"</span>,<span class="at">dpi=</span>res)</span>
<span id="cb66-291"><a href="#cb66-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-292"><a href="#cb66-292" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-293"><a href="#cb66-293" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-294"><a href="#cb66-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-295"><a href="#cb66-295" aria-hidden="true" tabindex="-1"></a>  <span class="do">## DHL: btn_downloadplot ----------------------------------------------------</span></span>
<span id="cb66-296"><a href="#cb66-296" aria-hidden="true" tabindex="-1"></a>  <span class="do">## download handler for downloading plot</span></span>
<span id="cb66-297"><a href="#cb66-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-298"><a href="#cb66-298" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>btn_downloadplot <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb66-299"><a href="#cb66-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename=</span>fn_downloadplotname,</span>
<span id="cb66-300"><a href="#cb66-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">content=</span><span class="cf">function</span>(file) {</span>
<span id="cb66-301"><a href="#cb66-301" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fn_downloadplot</span>()</span>
<span id="cb66-302"><a href="#cb66-302" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.copy</span>(<span class="fu">fn_downloadplotname</span>(),file,<span class="at">overwrite=</span>T)</span>
<span id="cb66-303"><a href="#cb66-303" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-304"><a href="#cb66-304" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-305"><a href="#cb66-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-306"><a href="#cb66-306" aria-hidden="true" tabindex="-1"></a>  <span class="do">## OBS: tracks dates ---------------------------------------------------------</span></span>
<span id="cb66-307"><a href="#cb66-307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-308"><a href="#cb66-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>({</span>
<span id="cb66-309"><a href="#cb66-309" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-310"><a href="#cb66-310" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_duration_date_start)</span>
<span id="cb66-311"><a href="#cb66-311" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(input<span class="sc">$</span>in_duration_date_end)</span>
<span id="cb66-312"><a href="#cb66-312" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-313"><a href="#cb66-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(<span class="fu">need</span>(<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_start) <span class="sc">&lt;</span> <span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_end),<span class="st">"End duration date must be later than start duration date."</span>))</span>
<span id="cb66-314"><a href="#cb66-314" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-315"><a href="#cb66-315" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create date intervals</span></span>
<span id="cb66-316"><a href="#cb66-316" aria-hidden="true" tabindex="-1"></a>    dseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_start),<span class="fu">as.Date</span>(input<span class="sc">$</span>in_duration_date_end),<span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb66-317"><a href="#cb66-317" aria-hidden="true" tabindex="-1"></a>    r1 <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(<span class="fu">cut</span>(dseq,<span class="at">breaks=</span><span class="dv">3</span>)))</span>
<span id="cb66-318"><a href="#cb66-318" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-319"><a href="#cb66-319" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateDateInput</span>(session,<span class="st">"in_track_date_start_1"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">as.Date</span>(r1[<span class="dv">1</span>],<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-320"><a href="#cb66-320" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateDateInput</span>(session,<span class="st">"in_track_date_end_1"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">as.Date</span>(r1[<span class="dv">1</span><span class="sc">+</span><span class="dv">1</span>],<span class="st">"%Y-%m-%d"</span>)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb66-321"><a href="#cb66-321" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateDateInput</span>(session,<span class="st">"in_track_date_start_2"</span>,<span class="at">label=</span><span class="st">"From"</span>,<span class="at">value=</span><span class="fu">as.Date</span>(r1[<span class="dv">2</span>],<span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-322"><a href="#cb66-322" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateDateInput</span>(session,<span class="st">"in_track_date_end_2"</span>,<span class="at">label=</span><span class="st">"To"</span>,<span class="at">value=</span><span class="fu">as.Date</span>(r1[<span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>],<span class="st">"%Y-%m-%d"</span>)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb66-323"><a href="#cb66-323" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-324"><a href="#cb66-324" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb66-325"><a href="#cb66-325" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/calendar-preview.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="assets/calendar-preview.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
</section>
</section>
<section id="nametagger-app" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="nametagger-app"><span class="header-section-number">14</span> Nametagger app</h2>
<p>Generate labels for clip-on nametags.</p>
<p><strong>Topics covered</strong></p>
<ul>
<li>UI layout using rows and columns</li>
<li>Input and output widgets and reactivity</li>
<li>Uploading and using the contents of a tabular text file</li>
<li>Reading in tabular text using text field (shinyAce)</li>
<li>Conditional settings panel</li>
<li>Read in and plot a raster image (logo)</li>
<li>Generate multiple output files</li>
<li>Download zipped output files</li>
<li>Validating inputs with custom error messages</li>
</ul>
<p>The following R packages will be required for this app:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(ggplot2, shiny, shinythemes, shinyAce, showtext, curl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The final app will look something like below.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/nametagger_preview.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="assets/nametagger_preview.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>The idea is to create the labels suitable for A4 paper size and generate as many pages as needed. We wish to include one, two or three lines of text on each label. Also, we may choose to include a logo. We need input for label information, option to select logo, a preview plot and finally an option to download the images.</p>
<section id="creating-the-figure" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="creating-the-figure"><span class="header-section-number">14.1</span> Creating the figure</h3>
<p>We need to first write the code needed to take some input labels and generate a figure.</p>
<p>We have measured the labels to be 9cm x 5.5cm which means that 8 of them will fit on an A4 paper suitable for print. We have the function for generating the plot below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nametag_plot_page ------------------------------------------------------------</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title nametag_plot_page</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description Creates a page with 1-8 nametags.</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param dfr A data.frame. See details.</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param logo_right A raster logo to be placed on the right.</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param logo_right_scale A scale value. Typically 0.1-0.4.</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param logo_right_offset Logo offset from the edge. Around 0.01-0.1.</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param height Height of nametag in cm. Defaults to 5.5.</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param width Width of nametag in cm. Defaults to 9.</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @details Argument 'dfr' is a data.frame that must have columns</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' label1, label1_x, label1_y, page, row and col.</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>nametag_plot_page <span class="ot">&lt;-</span> <span class="cf">function</span>(dfr,<span class="at">logo_right=</span><span class="cn">NULL</span>,logo_right_scale,logo_right_offset,<span class="at">height=</span><span class="fl">5.5</span>,<span class="at">width=</span><span class="dv">9</span>)</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">missing</span>(dfr)) <span class="fu">stop</span>(<span class="st">"Input argument 'dfr' missing."</span>)</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check columns</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  req_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"label1"</span>,<span class="st">"label1_sz"</span>,<span class="st">"label1_x"</span>,<span class="st">"label1_y"</span>,<span class="st">"page"</span>,<span class="st">"row"</span>,<span class="st">"col"</span>)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  chk_cols <span class="ot">&lt;-</span> req_cols <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span>chk_cols)) <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">"Input data is missing columns: "</span>,<span class="fu">paste0</span>(req_cols[<span class="sc">!</span>chk_cols],<span class="at">collapse=</span><span class="st">","</span>),<span class="st">"."</span>))</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add labels if any has length &gt;0</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfr)</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">nchar</span>(dfr<span class="sc">$</span>label1)<span class="sc">!=</span><span class="dv">0</span>)) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>label1_x,<span class="at">y=</span>label1_y,<span class="at">label=</span>label1),<span class="at">size=</span>dfr<span class="sc">$</span>label1_sz[<span class="dv">1</span>],<span class="at">fontface=</span><span class="st">"bold"</span>)</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label2"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)) {</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    req_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"label2_sz"</span>,<span class="st">"label2_x"</span>,<span class="st">"label2_y"</span>)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    chk_cols <span class="ot">&lt;-</span> req_cols <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span>chk_cols)) <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">"Input data contains column 'label2' but missing columns: "</span>,<span class="fu">paste0</span>(req_cols[<span class="sc">!</span>chk_cols],<span class="at">collapse=</span><span class="st">","</span>),<span class="st">"."</span>))</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">nchar</span>(dfr<span class="sc">$</span>label2)<span class="sc">!=</span><span class="dv">0</span>)) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>label2_x,<span class="at">y=</span>label2_y,<span class="at">label=</span>label2),<span class="at">size=</span>dfr<span class="sc">$</span>label2_sz[<span class="dv">1</span>])</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label3"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)) {</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    req_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"label3_sz"</span>,<span class="st">"label3_x"</span>,<span class="st">"label3_y"</span>)</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    chk_cols <span class="ot">&lt;-</span> req_cols <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span>chk_cols)) <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">"Input data contains column 'label2' but missing columns: "</span>,<span class="fu">paste0</span>(req_cols[<span class="sc">!</span>chk_cols],<span class="at">collapse=</span><span class="st">","</span>),<span class="st">"."</span>))</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">nchar</span>(dfr<span class="sc">$</span>label3)<span class="sc">!=</span><span class="dv">0</span>)) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>label3_x,<span class="at">y=</span>label3_y,<span class="at">label=</span>label3),<span class="at">size=</span>dfr<span class="sc">$</span>label3_sz[<span class="dv">1</span>])</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>)</span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>  w_scaler <span class="ot">&lt;-</span> width<span class="sc">/</span>height</span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check and add right logo</span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(logo_right)) {</span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># height scaling multiplier 1.6</span></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>    logo_right_height <span class="ot">&lt;-</span> ((logo_right_scale<span class="sc">*</span><span class="fu">nrow</span>(logo_right))<span class="sc">/</span><span class="fu">ncol</span>(logo_right))<span class="sc">*</span>w_scaler</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create logo positions</span></span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>    logo_right_x2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>logo_right_offset</span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a>    logo_right_x1 <span class="ot">&lt;-</span> logo_right_x2<span class="sc">-</span>logo_right_scale</span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a>    logo_right_y2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>(logo_right_offset<span class="sc">+</span>(logo_right_offset<span class="sc">*</span>w_scaler))</span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a>    logo_right_y1 <span class="ot">&lt;-</span> <span class="fu">round</span>(logo_right_y2<span class="sc">-</span>logo_right_height,<span class="dv">3</span>)</span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add right logo to plot</span></span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotation_raster</span>(logo_right,<span class="at">xmin=</span>logo_right_x1,<span class="at">xmax=</span>logo_right_x2,<span class="at">ymin=</span>logo_right_y1,<span class="at">ymax=</span>logo_right_y2)</span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p<span class="sc">+</span></span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(row<span class="sc">~</span>col)<span class="sc">+</span></span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-69"><a href="#cb68-69" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-70"><a href="#cb68-70" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.spacing=</span><span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">"lines"</span>),</span>
<span id="cb68-71"><a href="#cb68-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-72"><a href="#cb68-72" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-73"><a href="#cb68-73" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-74"><a href="#cb68-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background=</span><span class="fu">element_rect</span>(<span class="at">colour=</span><span class="st">"grey75"</span>,<span class="at">fill=</span><span class="st">"white"</span>,<span class="at">size=</span><span class="fl">0.4</span>,<span class="at">linetype=</span><span class="st">"25"</span>),</span>
<span id="cb68-75"><a href="#cb68-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-76"><a href="#cb68-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.margin=</span><span class="fu">margin</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>),</span>
<span id="cb68-77"><a href="#cb68-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.length=</span><span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">"pt"</span>))</span>
<span id="cb68-78"><a href="#cb68-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-79"><a href="#cb68-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb68-80"><a href="#cb68-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-81"><a href="#cb68-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-82"><a href="#cb68-82" aria-hidden="true" tabindex="-1"></a><span class="co"># nametag ----------------------------------------------------------------------</span></span>
<span id="cb68-83"><a href="#cb68-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-84"><a href="#cb68-84" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title nametag</span></span>
<span id="cb68-85"><a href="#cb68-85" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description Creates an A4 paper with 1-8 name tags.</span></span>
<span id="cb68-86"><a href="#cb68-86" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param dfr A data.frame with column 'label1'. Optionally 'label2' and 'label3'.</span></span>
<span id="cb68-87"><a href="#cb68-87" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label1_sz Size of label on line 1.</span></span>
<span id="cb68-88"><a href="#cb68-88" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label1_x X-axis coordinate for the label on line 1.</span></span>
<span id="cb68-89"><a href="#cb68-89" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label1_y Y-axis coordinate for the label on line 1.</span></span>
<span id="cb68-90"><a href="#cb68-90" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label2_sz Size of label on line 2.</span></span>
<span id="cb68-91"><a href="#cb68-91" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label2_x X-axis coordinate for the label on line 2.</span></span>
<span id="cb68-92"><a href="#cb68-92" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label2_y Y-axis coordinate for the label on line 2.</span></span>
<span id="cb68-93"><a href="#cb68-93" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label3_sz Size of label on line 3.</span></span>
<span id="cb68-94"><a href="#cb68-94" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label3_x X-axis coordinate for the label on line 3.</span></span>
<span id="cb68-95"><a href="#cb68-95" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param label3_y Y-axis coordinate for the label on line 3.</span></span>
<span id="cb68-96"><a href="#cb68-96" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param logo_right A raster logo for the right side.</span></span>
<span id="cb68-97"><a href="#cb68-97" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param logo_right_offset Logo offset from the edge. Around 0.01-0.1.</span></span>
<span id="cb68-98"><a href="#cb68-98" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param logo_right_scale A scale value. Typically 0.1-0.4.</span></span>
<span id="cb68-99"><a href="#cb68-99" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param filename A character denoting filename (prefix) of exported files.Defaults to 'nametag_' followed by page number and '.png'.</span></span>
<span id="cb68-100"><a href="#cb68-100" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param path A character path to the directory where file(s) are to be exported. Do not add / at the end of the path.</span></span>
<span id="cb68-101"><a href="#cb68-101" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param ftype Export file type. 'png' or 'pdf'. Defaults to 'png'.</span></span>
<span id="cb68-102"><a href="#cb68-102" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param height Height of nametag in cm. Defaults to 5.5.</span></span>
<span id="cb68-103"><a href="#cb68-103" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param width Width of nametag in cm. Defaults to 9.</span></span>
<span id="cb68-104"><a href="#cb68-104" aria-hidden="true" tabindex="-1"></a><span class="co">#' @details A data.frame with one column 'label1' is the only mandatory input for this function.</span></span>
<span id="cb68-105"><a href="#cb68-105" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb68-106"><a href="#cb68-106" aria-hidden="true" tabindex="-1"></a>nametag <span class="ot">&lt;-</span> <span class="cf">function</span>(dfr,<span class="at">label1_sz=</span><span class="dv">8</span>,<span class="at">label1_x=</span><span class="fl">0.5</span>,<span class="at">label1_y=</span><span class="fl">0.54</span>,</span>
<span id="cb68-107"><a href="#cb68-107" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label2_sz=</span><span class="fl">6.5</span>,<span class="at">label2_x=</span><span class="fl">0.5</span>,<span class="at">label2_y=</span><span class="fl">0.37</span>,</span>
<span id="cb68-108"><a href="#cb68-108" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label3_sz=</span><span class="dv">6</span>,<span class="at">label3_x=</span><span class="fl">0.5</span>,<span class="at">label3_y=</span><span class="fl">0.22</span>,</span>
<span id="cb68-109"><a href="#cb68-109" aria-hidden="true" tabindex="-1"></a>                    <span class="at">logo_right=</span><span class="cn">NULL</span>,<span class="at">logo_right_offset=</span><span class="fl">0.04</span>,<span class="at">logo_right_scale=</span><span class="fl">0.2</span>,</span>
<span id="cb68-110"><a href="#cb68-110" aria-hidden="true" tabindex="-1"></a>                    <span class="at">filename=</span><span class="st">"nametag_"</span>,<span class="at">path=</span><span class="st">"."</span>,<span class="at">ftype=</span><span class="st">"png"</span>,<span class="at">height=</span><span class="fl">5.5</span>,<span class="at">width=</span><span class="dv">9</span>)</span>
<span id="cb68-111"><a href="#cb68-111" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb68-112"><a href="#cb68-112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">missing</span>(dfr)) <span class="fu">stop</span>(<span class="st">"Input argument 'dfr' is missing."</span>)</span>
<span id="cb68-113"><a href="#cb68-113" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.data.frame</span>(dfr)) <span class="fu">stop</span>(<span class="st">"Input argument 'dfr' must be a data.frame."</span>)</span>
<span id="cb68-114"><a href="#cb68-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(dfr)<span class="sc">&lt;</span><span class="dv">1</span>) <span class="fu">stop</span>(<span class="st">"Input data must have at least 1 row."</span>)</span>
<span id="cb68-115"><a href="#cb68-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"label1"</span>  <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr))) <span class="fu">stop</span>(<span class="st">"Input data must contain a column named 'label1'."</span>)</span>
<span id="cb68-116"><a href="#cb68-116" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label3"</span>  <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)) {<span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"label2"</span>  <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr))) <span class="fu">stop</span>(<span class="st">"Column 'label3' is present, but 'label2' is missing. If 'label3' is used, 'label2' must be present."</span> )}</span>
<span id="cb68-117"><a href="#cb68-117" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(filename)) filename <span class="ot">&lt;-</span> <span class="st">"nametag_"</span></span>
<span id="cb68-118"><a href="#cb68-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-119"><a href="#cb68-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute tags and pages</span></span>
<span id="cb68-120"><a href="#cb68-120" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dfr)</span>
<span id="cb68-121"><a href="#cb68-121" aria-hidden="true" tabindex="-1"></a>  npages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n<span class="sc">/</span><span class="dv">8</span>)</span>
<span id="cb68-122"><a href="#cb68-122" aria-hidden="true" tabindex="-1"></a>  ntags <span class="ot">&lt;-</span> npages<span class="sc">*</span><span class="dv">8</span></span>
<span id="cb68-123"><a href="#cb68-123" aria-hidden="true" tabindex="-1"></a>  filler <span class="ot">&lt;-</span> ntags<span class="sc">-</span>n</span>
<span id="cb68-124"><a href="#cb68-124" aria-hidden="true" tabindex="-1"></a>  l1 <span class="ot">&lt;-</span> <span class="fu">c</span>(dfr<span class="sc">$</span>label1,<span class="fu">rep</span>(<span class="st">""</span>,filler))</span>
<span id="cb68-125"><a href="#cb68-125" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label2"</span>  <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)) l2 <span class="ot">&lt;-</span> <span class="fu">c</span>(dfr<span class="sc">$</span>label2,<span class="fu">rep</span>(<span class="st">""</span>,filler))</span>
<span id="cb68-126"><a href="#cb68-126" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label3"</span>  <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)) l3 <span class="ot">&lt;-</span> <span class="fu">c</span>(dfr<span class="sc">$</span>label3,<span class="fu">rep</span>(<span class="st">""</span>,filler))</span>
<span id="cb68-127"><a href="#cb68-127" aria-hidden="true" tabindex="-1"></a>  nn <span class="ot">&lt;-</span> <span class="fu">length</span>(l1)</span>
<span id="cb68-128"><a href="#cb68-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-129"><a href="#cb68-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create working df</span></span>
<span id="cb68-130"><a href="#cb68-130" aria-hidden="true" tabindex="-1"></a>  dfw <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">label1=</span>l1,<span class="at">label1_sz=</span>label1_sz,</span>
<span id="cb68-131"><a href="#cb68-131" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label1_x=</span><span class="fu">rep</span>(label1_x,nn),<span class="at">label1_y=</span><span class="fu">rep</span>(label1_y,nn),</span>
<span id="cb68-132"><a href="#cb68-132" aria-hidden="true" tabindex="-1"></a>                    <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb68-133"><a href="#cb68-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-134"><a href="#cb68-134" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label2"</span>  <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)) {</span>
<span id="cb68-135"><a href="#cb68-135" aria-hidden="true" tabindex="-1"></a>    dfw<span class="sc">$</span>label2 <span class="ot">&lt;-</span> l2</span>
<span id="cb68-136"><a href="#cb68-136" aria-hidden="true" tabindex="-1"></a>    dfw<span class="sc">$</span>label2_sz <span class="ot">&lt;-</span> label2_sz</span>
<span id="cb68-137"><a href="#cb68-137" aria-hidden="true" tabindex="-1"></a>    dfw<span class="sc">$</span>label2_x <span class="ot">&lt;-</span> <span class="fu">rep</span>(label2_x,nn)</span>
<span id="cb68-138"><a href="#cb68-138" aria-hidden="true" tabindex="-1"></a>    dfw<span class="sc">$</span>label2_y <span class="ot">&lt;-</span> <span class="fu">rep</span>(label2_y,nn)</span>
<span id="cb68-139"><a href="#cb68-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-140"><a href="#cb68-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-141"><a href="#cb68-141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label3"</span>  <span class="sc">%in%</span> <span class="fu">colnames</span>(dfr)) {</span>
<span id="cb68-142"><a href="#cb68-142" aria-hidden="true" tabindex="-1"></a>    dfw<span class="sc">$</span>label3 <span class="ot">&lt;-</span> l3</span>
<span id="cb68-143"><a href="#cb68-143" aria-hidden="true" tabindex="-1"></a>    dfw<span class="sc">$</span>label3_sz <span class="ot">&lt;-</span> label3_sz</span>
<span id="cb68-144"><a href="#cb68-144" aria-hidden="true" tabindex="-1"></a>    dfw<span class="sc">$</span>label3_x <span class="ot">&lt;-</span> <span class="fu">rep</span>(label3_x,nn)</span>
<span id="cb68-145"><a href="#cb68-145" aria-hidden="true" tabindex="-1"></a>    dfw<span class="sc">$</span>label3_y <span class="ot">&lt;-</span> <span class="fu">rep</span>(label3_y,nn)</span>
<span id="cb68-146"><a href="#cb68-146" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-147"><a href="#cb68-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-148"><a href="#cb68-148" aria-hidden="true" tabindex="-1"></a>  dfw<span class="sc">$</span>page <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>npages,<span class="at">each=</span><span class="dv">8</span>)</span>
<span id="cb68-149"><a href="#cb68-149" aria-hidden="true" tabindex="-1"></a>  dfw<span class="sc">$</span>row <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="at">each=</span><span class="dv">2</span>),npages)</span>
<span id="cb68-150"><a href="#cb68-150" aria-hidden="true" tabindex="-1"></a>  dfw<span class="sc">$</span>col <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">4</span>),npages)</span>
<span id="cb68-151"><a href="#cb68-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-152"><a href="#cb68-152" aria-hidden="true" tabindex="-1"></a>  dflist <span class="ot">&lt;-</span> <span class="fu">split</span>(dfw,dfw<span class="sc">$</span>page)</span>
<span id="cb68-153"><a href="#cb68-153" aria-hidden="true" tabindex="-1"></a>  ids <span class="ot">&lt;-</span> <span class="fu">names</span>(dflist)</span>
<span id="cb68-154"><a href="#cb68-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-155"><a href="#cb68-155" aria-hidden="true" tabindex="-1"></a>  <span class="co"># creates plots and saves ggplot objects to a list</span></span>
<span id="cb68-156"><a href="#cb68-156" aria-hidden="true" tabindex="-1"></a>  plist <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dflist,nametag_plot_page,logo_right,logo_right_scale,logo_right_offset,<span class="at">height=</span>height,<span class="at">width=</span>width)</span>
<span id="cb68-157"><a href="#cb68-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-158"><a href="#cb68-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function to export images</span></span>
<span id="cb68-159"><a href="#cb68-159" aria-hidden="true" tabindex="-1"></a>  efun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,id,height,width,filename,ftype) {</span>
<span id="cb68-160"><a href="#cb68-160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(ftype<span class="sc">==</span><span class="st">"png"</span>) {</span>
<span id="cb68-161"><a href="#cb68-161" aria-hidden="true" tabindex="-1"></a>      fname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path,<span class="st">"/"</span>,filename,id,<span class="st">".png"</span>)</span>
<span id="cb68-162"><a href="#cb68-162" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="at">filename=</span>fname,<span class="at">plot=</span>p,<span class="at">height=</span>height<span class="sc">*</span><span class="dv">4</span>,<span class="at">width=</span>width<span class="sc">*</span><span class="dv">2</span>,<span class="at">units=</span><span class="st">"cm"</span>,<span class="at">dpi=</span><span class="dv">300</span>,<span class="at">device=</span><span class="st">"png"</span>)</span>
<span id="cb68-163"><a href="#cb68-163" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb68-164"><a href="#cb68-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(ftype<span class="sc">==</span><span class="st">"pdf"</span>) {</span>
<span id="cb68-165"><a href="#cb68-165" aria-hidden="true" tabindex="-1"></a>      fname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path,<span class="st">"/"</span>,filename,id,<span class="st">".pdf"</span>)</span>
<span id="cb68-166"><a href="#cb68-166" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="at">filename=</span>fname,<span class="at">plot=</span>p,<span class="at">height=</span>height<span class="sc">*</span><span class="dv">4</span><span class="sc">*</span><span class="fl">0.3937</span>,<span class="at">width=</span>width<span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="fl">0.3937</span>,<span class="at">device=</span><span class="st">"pdf"</span>)</span>
<span id="cb68-167"><a href="#cb68-167" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb68-168"><a href="#cb68-168" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-169"><a href="#cb68-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-170"><a href="#cb68-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exports images</span></span>
<span id="cb68-171"><a href="#cb68-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapply</span>(<span class="cf">function</span>(p,id,height,width,filename,ftype) <span class="fu">efun</span>(p,id,height,width,filename,ftype),plist,ids,height,width,filename,ftype)</span>
<span id="cb68-172"><a href="#cb68-172" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will skip the details of the function as it is not exactly shiny related. There is a function called <code>nametag()</code> which generates the figures given appropriate input. It needs an input data.frame with at least one column named <code>label1</code>. We can test this out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>dfr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">label1=</span><span class="fu">c</span>(<span class="st">"Person A"</span>,<span class="st">"Person B"</span>),<span class="at">label2=</span><span class="fu">c</span>(<span class="st">"Institution X"</span>,<span class="st">"Institution Y"</span>),<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nametag</span>(dfr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This should have exported a PNG image to the working directory. <code>nametag()</code> also has an argument called <code>logo_right</code> to pass in a raster image which will be plotted as a logo on the top right side. <code>nametag()</code> also has numerous other arguments to adjust label positions, logo position, size justification etc. But, these arguments have reasonable defaults.</p>
</section>
<section id="building-the-app-1" class="level3" data-number="14.2">
<h3 data-number="14.2" class="anchored" data-anchor-id="building-the-app-1"><span class="header-section-number">14.2</span> Building the app</h3>
<p>Now that we have the function, we are ready to build the GUI around it. Let’s remind ourselves of the app layout.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/nametagger_preview.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="assets/nametagger_preview.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<section id="ui-2" class="level4" data-number="14.2.1">
<h4 data-number="14.2.1" class="anchored" data-anchor-id="ui-2"><span class="header-section-number">14.2.1</span> UI</h4>
<p>We want a three-column layout with a title panel on the top. The input widgets go on the left and the preview figure in the middle and the optional settings on the right. We can start by building up the structure using row and column functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fixedRow</span>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">column</span>(<span class="dv">12</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h1</span>(<span class="st">"Nametagger"</span>),</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixedRow</span>(</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">3</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">6</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">uiOutput</span>(<span class="st">"ui_settings"</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output) {},</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">options=</span><span class="fu">list</span>(<span class="at">height=</span><span class="st">"400px"</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-61-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="index_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>This code displays a blank page with the title. But, there is quite a bit going on here. We started with a responsive <code>fluidPage</code> container. We added a row and a column to hold everything. This column has the full width of 12. We added the h1 heading. Then we added a new row which contains 3 columns of widths 3,6 and 3 adding up to 12. The first column will hold the standard input widgets, second column will contain the preview plot and the last column is a hidden conditional UI which will hold the optional settings. Conditional UI defined using <code>uiOutput()</code> is hidden by default and is displayed only if a condition is true.</p>
<p>Next, we will populate the columns with widgets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fixedRow</span>(</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">column</span>(<span class="dv">12</span>,<span class="at">style=</span><span class="st">"margin:15px;"</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h1</span>(<span class="st">"Nametagger"</span>),</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixedRow</span>(</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">3</span>,</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">selectInput</span>(<span class="st">"in_input"</span>,<span class="st">"Input method"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"Upload file"</span>,<span class="st">"Paste text"</span>),</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">selected=</span><span class="st">"Paste text"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>)),</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">selectInput</span>(<span class="st">"in_data_format"</span>,<span class="st">"File format"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"tsv"</span>,<span class="st">"csv"</span>,<span class="st">"csv2"</span>),<span class="at">selected=</span><span class="st">"csv"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>))</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">uiOutput</span>(<span class="st">"ui_input"</span>),</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">helpText</span>(<span class="st">"Input must contain column names. 'label1' is a mandatory column. Optional columns are 'label2' and 'label3'."</span>,<span class="at">style=</span><span class="st">"display:inline;"</span>),</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"in_logo_right"</span>,<span class="at">label=</span><span class="st">"Logo"</span>,<span class="fu">c</span>(<span class="st">"None"</span>,<span class="st">"NBIS Green"</span>,<span class="st">"NBIS Blue"</span>,<span class="st">"NBIS Orange"</span>,<span class="st">"SciLifeLab Green"</span>,<span class="st">"SciLifeLab Blue"</span>,<span class="st">"SciLifeLab Orange"</span>,<span class="st">"Elixir"</span>),<span class="at">selected=</span><span class="st">"None"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">downloadButton</span>(<span class="st">"btn_download"</span>,<span class="st">"Download"</span>),</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">checkboxInput</span>(<span class="st">"in_settings"</span>,<span class="st">"Settings"</span>,<span class="at">value=</span><span class="cn">FALSE</span>),</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">hr</span>(),</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">helpText</span>(<span class="st">"RaukR"</span>)</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">6</span>,</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">"out_pagecount"</span>),</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">imageOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">uiOutput</span>(<span class="st">"ui_settings"</span>)</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>)),</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output) {}</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/nametagger-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="assets/nametagger-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>We have added input for file upload and paste text so that users can input labels either way. The tabular column delimiter can be user-defined. The actual input widget is hidden since it’s a conditional UI. This works only when further code is defined under server. A help text is added to explain the input format to the user. A download button to download the images. A settings checkbox to optionally display the advanced settings panel. The main column has text showing number of files generated and the preview plot.</p>
<p>Finally, we will add some custom styling to the columns. For example <code>style="max-width:300px;border-radius:4px;background:#ebedef;"</code> was added to the left input column to color the background gray, rounded corners and limit responsive width to 300px.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fixedRow</span>(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">column</span>(<span class="dv">12</span>,<span class="at">style=</span><span class="st">"margin:15px;"</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h1</span>(<span class="st">"Nametagger"</span>),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixedRow</span>(</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="st">"max-width:300px;background:#ebedef;padding-top:15px;padding-bottom:15px;border-radius:4px;"</span>,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right:5px;"</span>),</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">selectInput</span>(<span class="st">"in_input"</span>,<span class="st">"Input method"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"Upload file"</span>,<span class="st">"Paste text"</span>),</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">selected=</span><span class="st">"Paste text"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>)),</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">selectInput</span>(<span class="st">"in_data_format"</span>,<span class="st">"File format"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"tsv"</span>,<span class="st">"csv"</span>,<span class="st">"csv2"</span>),<span class="at">selected=</span><span class="st">"csv"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>))</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">uiOutput</span>(<span class="st">"ui_input"</span>),</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">helpText</span>(<span class="st">"Input must contain column names. 'label1' is a mandatory column. Optional columns are 'label2' and 'label3'."</span>,<span class="at">style=</span><span class="st">"display:inline;"</span>),</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"in_logo_right"</span>,<span class="at">label=</span><span class="st">"Logo"</span>,<span class="fu">c</span>(<span class="st">"None"</span>,<span class="st">"NBIS Green"</span>,<span class="st">"NBIS Blue"</span>,<span class="st">"NBIS Orange"</span>,<span class="st">"SciLifeLab Green"</span>,<span class="st">"SciLifeLab Blue"</span>,<span class="st">"SciLifeLab Orange"</span>,<span class="st">"Elixir"</span>),<span class="at">selected=</span><span class="st">"None"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">downloadButton</span>(<span class="st">"btn_download"</span>,<span class="st">"Download"</span>),</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">checkboxInput</span>(<span class="st">"in_settings"</span>,<span class="st">"Settings"</span>,<span class="at">value=</span><span class="cn">FALSE</span>),</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">hr</span>(),</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">helpText</span>(<span class="st">"RaukR"</span>)</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="st">"max-width:450px;min-width:400px;padding-top:15px;padding-bottom:15px;border-radius:4px;"</span>,</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">"out_pagecount"</span>),</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">imageOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">uiOutput</span>(<span class="st">"ui_settings"</span>)</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a><span class="at">server=</span><span class="cf">function</span>(input,output) {}</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/nametagger-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="assets/nametagger-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</section>
<section id="server-2" class="level4" data-number="14.2.2">
<h4 data-number="14.2.2" class="anchored" data-anchor-id="server-2"><span class="header-section-number">14.2.2</span> Server</h4>
<p>Now let’s plan a bit on how to organize the server code. We can break it up into 8 blocks.</p>
<ol type="1">
<li>Conditional UI for input</li>
<li>Conditional UI for settings</li>
<li>Reactive function for reading and processing input</li>
<li>Reactive function for computing plotting parameters</li>
<li>Plot output for plotting preview</li>
<li>Text output for displaying number of files generated</li>
<li>Function for downloading files</li>
<li>A download handler for the download button</li>
</ol>
<p>Here is a flow diagram roughly showing the sequence of steps. <code>&lt; &gt; v</code> denotes direction, <code>()</code> denotes optional input and <code>[]</code> denotes endpoint outputs.</p>
<pre><code>      1
      v
[6] &lt; 3 &lt; (2)
      v
      4 &gt; [7] &lt; 8
      v
     [5]</code></pre>
<p>The plot preview block (5) and download block (7) depends on common reactive functions 3 and 4.</p>
<p>Let’s look at block 1. This is a conditional UI which is active only if the <strong>Input method</strong> (<code>input$in_input</code>) is not NULL. If input method is <strong>Upload file</strong>, then the UI for file upload is displayed, otherwise the input method is paste text (aceEditor).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">## UI: ui_input --------------------------------------------------------------</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ui to select input type: upload or paste</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>ui_input <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_input))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(input<span class="sc">$</span>in_input<span class="sc">==</span><span class="st">"Upload file"</span>) {</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fileInput</span>(<span class="st">"in_data"</span>,<span class="st">"Upload a text file."</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  shinyAce<span class="sc">::</span><span class="fu">aceEditor</span>(<span class="st">"in_data"</span>,<span class="st">"label1,label2</span><span class="sc">\n</span><span class="st">John Doe,Uppsala University</span><span class="sc">\n</span><span class="st">Mary Jane,Stockholm University"</span>,<span class="at">mode=</span><span class="st">"text"</span>,<span class="at">theme=</span><span class="st">"textmate"</span>,<span class="at">readOnly=</span><span class="cn">FALSE</span>,<span class="at">height=</span><span class="st">"150px"</span>,<span class="at">fontSize=</span><span class="dv">12</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The settings panel is displayed only if the <strong>Settings</strong> checkbox is displayed. This panel contains input widgets for adjusting the position and alignment of text and logo.</p>
<p>Let’s look at block 3 to process input data. It depends on input method and input data format. Depending on the input method (file upload/paste text), different processing steps are carried out eventually resulting in identical output data.frame structure. Upload file is read in using defined separator. For paste-text field, the input is split by separator and organized into a data.frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">## FN: fn_input --------------------------------------------------------</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="do">## function to get input data</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>fn_input <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_input))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">try</span>(input<span class="sc">$</span>in_data),<span class="at">message1=</span><span class="st">"Upload a file or paste text."</span>))</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_data_format))</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  fr <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(input<span class="sc">$</span>in_data_format<span class="sc">==</span><span class="st">"tsv"</span>,<span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,<span class="fu">ifelse</span>(input<span class="sc">$</span>in_data_format<span class="sc">==</span><span class="st">"csv"</span>,<span class="st">","</span>,<span class="st">";"</span>))</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(input<span class="sc">$</span>in_input<span class="sc">==</span><span class="st">"Upload file"</span>) {</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    dfr <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(input<span class="sc">$</span>in_data<span class="sc">$</span>datapath,<span class="at">header=</span><span class="cn">TRUE</span>,<span class="at">sep=</span>fr,<span class="at">stringsAsFactors=</span>F)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(input<span class="sc">$</span>in_input<span class="sc">==</span><span class="st">"Paste text"</span>) {</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    df1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(input<span class="sc">$</span>in_data,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))),fr))</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>    cnames <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df1[,<span class="dv">1</span>])</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    df1[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    dfr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(df1),<span class="at">stringsAsFactors=</span>F)</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(dfr) <span class="ot">&lt;-</span> cnames</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(dfr) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dfr)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(dfr) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(dfr))</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dfr)</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s explore the block 4 that generates the plotting parameters. It depends on block 3 (<code>fn_input()</code>), settings checkbox (<code>input$in_settings</code>) and logo dropdown (<code>input$in_logo_right</code>).</p>
<p>It checks if columns <code>label1</code>,<code>label2</code> and <code>label3</code> are present in the input data.frame. Label size, x-position, y-position, logo scale and logo offset and set from input widgets or defaults are set. Depending on selected logo, the path is set and logo is read in. All these parameters are returned as a list.</p>
<p>The logos are placed under a directory named <strong>www</strong> in the app root.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="do">## FN: fn_params ------------------------------------------------------------</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="do">## function to get plot params</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>fn_params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_input</span>()))</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_settings))</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_logo_right))</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(<span class="fu">fn_input</span>())) {l1 <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}<span class="cf">else</span>{l1 <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label2"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(<span class="fu">fn_input</span>())) {l2 <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}<span class="cf">else</span>{l2 <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"label3"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(<span class="fu">fn_input</span>())) {l3 <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}<span class="cf">else</span>{l3 <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if values are available, use them, else use defaults</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label1_size)){l1s <span class="ot">&lt;-</span> <span class="dv">8</span>}<span class="cf">else</span>{l1s <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label1_size}</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label1_x)){l1x <span class="ot">&lt;-</span> <span class="fl">0.5</span>}<span class="cf">else</span>{l1x <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label1_x}</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label1_y)){l1y <span class="ot">&lt;-</span> <span class="fl">0.54</span>}<span class="cf">else</span>{l1y <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label1_y}</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label2_size)){l2s <span class="ot">&lt;-</span> <span class="fl">6.5</span>}<span class="cf">else</span>{l2s <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label2_size}</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label2_x)){l2x <span class="ot">&lt;-</span> <span class="fl">0.5</span>}<span class="cf">else</span>{l2x <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label2_x}</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label2_y)){l2y <span class="ot">&lt;-</span> <span class="fl">0.37</span>}<span class="cf">else</span>{l2y <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label2_y}</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label3_size)){l3s <span class="ot">&lt;-</span> <span class="dv">6</span>}<span class="cf">else</span>{l3s <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label3_size}</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label3_x)){l3x <span class="ot">&lt;-</span> <span class="fl">0.5</span>}<span class="cf">else</span>{l3x <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label3_x}</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label3_y)){l3y <span class="ot">&lt;-</span> <span class="fl">0.22</span>}<span class="cf">else</span>{l3y <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label3_y}</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_logo_right_offset)){lro <span class="ot">&lt;-</span> <span class="fl">0.04</span>}<span class="cf">else</span>{lro <span class="ot">&lt;-</span> input<span class="sc">$</span>in_logo_right_offset}</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_logo_right_scale)){lrs <span class="ot">&lt;-</span> <span class="fl">0.2</span>}<span class="cf">else</span>{lrs <span class="ot">&lt;-</span> input<span class="sc">$</span>in_logo_right_scale}</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># logos</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>  lr <span class="ot">=</span> <span class="cf">switch</span>(</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    input<span class="sc">$</span>in_logo_right,</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"None"</span><span class="ot">=</span><span class="cn">NULL</span>,</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NBIS Green"</span><span class="ot">=</span><span class="st">"./www/nbis_200_green.png"</span>,</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NBIS Blue"</span><span class="ot">=</span><span class="st">"./www/nbis_200_blue.png"</span>,</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NBIS Orange"</span><span class="ot">=</span><span class="st">"./www/nbis_200_orange.png"</span>,</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SciLifeLab Green"</span><span class="ot">=</span><span class="st">"./www/scilifelab_200_green.png"</span>,</span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SciLifeLab Blue"</span><span class="ot">=</span><span class="st">"./www/scilifelab_200_blue.png"</span>,</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SciLifeLab Orange"</span><span class="ot">=</span><span class="st">"./www/scilifelab_200_orange.png"</span>,</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Elixir"</span><span class="ot">=</span><span class="st">"./www/elixir_200.png"</span></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lr)) {lri <span class="ot">&lt;-</span> <span class="fu">readPNG</span>(lr)}<span class="cf">else</span>{lri <span class="ot">&lt;-</span> <span class="cn">NULL</span>}</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">l1s=</span>l1s,<span class="at">l1x=</span>l1x,<span class="at">l1y=</span>l1y,<span class="at">l2s=</span>l2s,<span class="at">l2x=</span>l2x,<span class="at">l2y=</span>l2y,<span class="at">l3s=</span>l3s,<span class="at">l3x=</span>l3x,<span class="at">l3y=</span>l3y,</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">lro=</span>lro,<span class="at">lrs=</span>lrs,<span class="at">lri=</span>lri))</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we have block 5 which creates the preview plot. It takes input from block 3 (<code>fn_input()</code>) and parameters from block 4 (<code>fn_params()</code>) which are passed to our <code>nametag()</code> function. Lastly, a list is returned with image path and render dimensions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="do">## OUT: out_plot ------------------------------------------------------------</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="do">## plots figure</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderImage</span>({</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_input</span>()))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_params</span>()))</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">fn_params</span>()</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nametag</span>(<span class="at">dfr=</span><span class="fu">fn_input</span>(),<span class="at">label1_sz=</span>p<span class="sc">$</span>l1s,<span class="at">label1_x=</span>p<span class="sc">$</span>l1x,<span class="at">label1_y=</span>p<span class="sc">$</span>l1y,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">label2_sz=</span>p<span class="sc">$</span>l2s,<span class="at">label2_x=</span>p<span class="sc">$</span>l2x,<span class="at">label2_y=</span>p<span class="sc">$</span>l2y,</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">label3_sz=</span>p<span class="sc">$</span>l3s,<span class="at">label3_x=</span>p<span class="sc">$</span>l3x,<span class="at">label3_y=</span>p<span class="sc">$</span>l3y,</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">logo_right=</span>p<span class="sc">$</span>lri,<span class="at">logo_right_offset=</span>p<span class="sc">$</span>lro,<span class="at">logo_right_scale=</span>p<span class="sc">$</span>lrs)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">src=</span><span class="st">"nametag_1.png"</span>,<span class="at">contentType=</span><span class="st">"image/png"</span>,</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">width=</span><span class="fu">round</span>(<span class="dv">9</span><span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="fl">37.7</span><span class="sc">*</span><span class="fl">0.6</span>,<span class="dv">0</span>),</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">height=</span><span class="fu">round</span>(<span class="fl">5.5</span><span class="sc">*</span><span class="dv">4</span><span class="sc">*</span><span class="fl">37.7</span><span class="sc">*</span><span class="fl">0.6</span>,<span class="dv">0</span>),</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">alt=</span><span class="st">"nametagger_image"</span>))</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Block 6 simply prints out the number of pages of images.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="do">## OUT: out_pagecount -------------------------------------------------------</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="do">## prints general variables for debugging</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>out_pagecount <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req</span>(<span class="fu">fn_input</span>())</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  npages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">nrow</span>(<span class="fu">fn_input</span>())<span class="sc">/</span><span class="dv">8</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Showing 1 of "</span>,npages,<span class="st">" pages."</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is block 7 and 8. Block 7 is the download function. This is very similar to the plotting block. The only real addition here is creation of the zip file collating all output PNGs. Individual images are then deleted. Block 8 below when triggered using the download button calls the <code>fn_download()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="do">## FN: fn_download -----------------------------------------------------------</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="do">## function to download a zipped file with images</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>fn_download <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_input</span>()))</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_params</span>()))</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">fn_params</span>()</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nametag</span>(<span class="at">dfr=</span><span class="fu">fn_input</span>(),<span class="at">label1_sz=</span>p<span class="sc">$</span>l1s,<span class="at">label1_x=</span>p<span class="sc">$</span>l1x,<span class="at">label1_y=</span>p<span class="sc">$</span>l1y,</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">label2_sz=</span>p<span class="sc">$</span>l2s,<span class="at">label2_x=</span>p<span class="sc">$</span>l2x,<span class="at">label2_y=</span>p<span class="sc">$</span>l2y,</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">label3_sz=</span>p<span class="sc">$</span>l3s,<span class="at">label3_x=</span>p<span class="sc">$</span>l3x,<span class="at">label3_y=</span>p<span class="sc">$</span>l3y,</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">logo_right=</span>p<span class="sc">$</span>lri,<span class="at">logo_right_offset=</span>p<span class="sc">$</span>lro,<span class="at">logo_right_scale=</span>p<span class="sc">$</span>lrs,</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">path=</span><span class="st">"."</span>)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlink</span>(<span class="st">"nametagger.zip"</span>)</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">zip</span>(<span class="st">"nametagger.zip"</span>,<span class="at">files=</span><span class="fu">list.files</span>()[<span class="fu">grep</span>(<span class="st">"nametag_[0-9]+[.png$|.pdf$]"</span>,<span class="fu">list.files</span>())])</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlink</span>(<span class="fu">list.files</span>()[<span class="fu">grep</span>(<span class="st">"nametag_[0-9]+[.png$|.pdf$]"</span>,<span class="fu">list.files</span>())])</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="do">## DHL: btn_download ---------------------------------------------------------</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="do">## download handler for downloading zipped file</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>btn_download <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename=</span><span class="st">"nametagger.zip"</span>,</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">content=</span><span class="cf">function</span>(file) {</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fn_download</span>()</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.copy</span>(<span class="st">"nametagger.zip"</span>,file,<span class="at">overwrite=</span>T)</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we can add all of this to the server section. The final code looks like below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinyAce)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># UI -------------------------------------------------------------------------</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ui=</span><span class="fu">fluidPage</span>(</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixedRow</span>(</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">column</span>(<span class="dv">12</span>,<span class="at">style=</span><span class="st">"margin:15px;"</span>,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">h1</span>(<span class="st">"Nametagger"</span>),</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>             <span class="fu">fixedRow</span>(</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>               <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="st">"max-width:300px;background:#ebedef;padding-top:15px;padding-bottom:15px;border-radius:4px;"</span>,</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">fluidRow</span>(</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right:5px;"</span>),</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">selectInput</span>(<span class="st">"in_input"</span>,<span class="st">"Input method"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"Upload file"</span>,<span class="st">"Paste text"</span>),</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">selected=</span><span class="st">"Paste text"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>)),</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 5px;"</span>),</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">selectInput</span>(<span class="st">"in_data_format"</span>,<span class="st">"File format"</span>,<span class="at">choices=</span><span class="fu">c</span>(<span class="st">"tsv"</span>,<span class="st">"csv"</span>,<span class="st">"csv2"</span>),<span class="at">selected=</span><span class="st">"csv"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>))</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>                      ),</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">uiOutput</span>(<span class="st">"ui_input"</span>),</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">helpText</span>(<span class="st">"Input must contain column names. 'label1' is a mandatory column. Optional columns are 'label2' and 'label3'."</span>,<span class="at">style=</span><span class="st">"display:inline;"</span>),</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">selectInput</span>(<span class="st">"in_logo_right"</span>,<span class="at">label=</span><span class="st">"Logo"</span>,<span class="fu">c</span>(<span class="st">"None"</span>,<span class="st">"NBIS Green"</span>,<span class="st">"NBIS Blue"</span>,<span class="st">"NBIS Orange"</span>,<span class="st">"SciLifeLab Green"</span>,<span class="st">"SciLifeLab Blue"</span>,<span class="st">"SciLifeLab Orange"</span>,<span class="st">"Elixir"</span>),<span class="at">selected=</span><span class="st">"None"</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>),</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">downloadButton</span>(<span class="st">"btn_download"</span>,<span class="st">"Download"</span>),</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">checkboxInput</span>(<span class="st">"in_settings"</span>,<span class="st">"Settings"</span>,<span class="at">value=</span><span class="cn">FALSE</span>),</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>                      tags<span class="sc">$</span><span class="fu">hr</span>(),</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">helpText</span>(<span class="st">"RaukR"</span>)</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>               <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="st">"max-width:450px;min-width:400px;padding-top:15px;padding-bottom:15px;border-radius:4px;"</span>,</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">textOutput</span>(<span class="st">"out_pagecount"</span>),</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>                      tags<span class="sc">$</span><span class="fu">br</span>(),</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">imageOutput</span>(<span class="st">"out_plot"</span>)</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>               <span class="fu">uiOutput</span>(<span class="st">"ui_settings"</span>)</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SERVER -----------------------------------------------------------------------</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">server=</span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>    <span class="do">## UI: ui_input --------------------------------------------------------------</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>    <span class="do">## ui to select input type: upload or paste</span></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>ui_input <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_input))</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(input<span class="sc">$</span>in_input<span class="sc">==</span><span class="st">"Upload file"</span>) {</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fileInput</span>(<span class="st">"in_data"</span>,<span class="st">"Upload a text file."</span>,<span class="at">multiple=</span><span class="cn">FALSE</span>)</span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>        shinyAce<span class="sc">::</span><span class="fu">aceEditor</span>(<span class="st">"in_data"</span>,<span class="st">"label1,label2</span><span class="sc">\n</span><span class="st">John Doe,Uppsala University</span><span class="sc">\n</span><span class="st">Mary Jane,Stockholm University"</span>,<span class="at">mode=</span><span class="st">"text"</span>,<span class="at">theme=</span><span class="st">"textmate"</span>,<span class="at">readOnly=</span><span class="cn">FALSE</span>,<span class="at">height=</span><span class="st">"150px"</span>,<span class="at">fontSize=</span><span class="dv">12</span>)</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a>    <span class="do">## UI: ui_settings -----------------------------------------------------------</span></span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>    <span class="do">## ui to display settings</span></span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>ui_settings <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_settings))</span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(input<span class="sc">$</span>in_settings) {</span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">column</span>(<span class="dv">3</span>,<span class="at">style=</span><span class="st">"max-width:300px;border-radius:4px;background:#ebedef;"</span>,</span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>               <span class="fu">h4</span>(<span class="st">"Settings"</span>),</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a>               <span class="fu">div</span>(</span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a>                 tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Label 1"</span>),</span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">fluidRow</span>(</span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px;"</span>),</span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label1_size"</span>,<span class="at">label=</span><span class="st">"Size"</span>,<span class="at">value=</span><span class="dv">8</span>,<span class="at">min=</span><span class="dv">4</span>,<span class="at">max=</span><span class="dv">12</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label1_x"</span>,<span class="at">label=</span><span class="st">"X pos"</span>,<span class="at">value=</span><span class="fl">0.5</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.02</span>)</span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 3px;"</span>),</span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label1_y"</span>,<span class="at">label=</span><span class="st">"Y pos"</span>,<span class="at">value=</span><span class="fl">0.54</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.02</span>)</span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true" tabindex="-1"></a>                 tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Label 2"</span>),</span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">fluidRow</span>(</span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px;"</span>),</span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label2_size"</span>,<span class="at">label=</span><span class="st">"Size"</span>,<span class="at">value=</span><span class="fl">6.5</span>,<span class="at">min=</span><span class="dv">4</span>,<span class="at">max=</span><span class="dv">12</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb80-81"><a href="#cb80-81" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb80-82"><a href="#cb80-82" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label2_x"</span>,<span class="at">label=</span><span class="st">"X pos"</span>,<span class="at">value=</span><span class="fl">0.5</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.02</span>)</span>
<span id="cb80-83"><a href="#cb80-83" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb80-84"><a href="#cb80-84" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 3px;"</span>),</span>
<span id="cb80-85"><a href="#cb80-85" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label2_y"</span>,<span class="at">label=</span><span class="st">"Y pos"</span>,<span class="at">value=</span><span class="fl">0.37</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.02</span>)</span>
<span id="cb80-86"><a href="#cb80-86" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb80-87"><a href="#cb80-87" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb80-88"><a href="#cb80-88" aria-hidden="true" tabindex="-1"></a>                 tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Label 3"</span>),</span>
<span id="cb80-89"><a href="#cb80-89" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">fluidRow</span>(</span>
<span id="cb80-90"><a href="#cb80-90" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px;"</span>),</span>
<span id="cb80-91"><a href="#cb80-91" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label3_size"</span>,<span class="at">label=</span><span class="st">"Size"</span>,<span class="at">value=</span><span class="dv">6</span>,<span class="at">min=</span><span class="dv">4</span>,<span class="at">max=</span><span class="dv">12</span>,<span class="at">step=</span><span class="fl">0.5</span>)</span>
<span id="cb80-92"><a href="#cb80-92" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb80-93"><a href="#cb80-93" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px; padding-left: 3px;"</span>),</span>
<span id="cb80-94"><a href="#cb80-94" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label3_x"</span>,<span class="at">label=</span><span class="st">"X pos"</span>,<span class="at">value=</span><span class="fl">0.5</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.02</span>)</span>
<span id="cb80-95"><a href="#cb80-95" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb80-96"><a href="#cb80-96" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 3px;"</span>),</span>
<span id="cb80-97"><a href="#cb80-97" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_label3_y"</span>,<span class="at">label=</span><span class="st">"Y pos"</span>,<span class="at">value=</span><span class="fl">0.22</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>,<span class="at">step=</span><span class="fl">0.02</span>)</span>
<span id="cb80-98"><a href="#cb80-98" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb80-99"><a href="#cb80-99" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb80-100"><a href="#cb80-100" aria-hidden="true" tabindex="-1"></a>                 tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Logo"</span>),</span>
<span id="cb80-101"><a href="#cb80-101" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">fluidRow</span>(</span>
<span id="cb80-102"><a href="#cb80-102" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-right: 3px;"</span>),</span>
<span id="cb80-103"><a href="#cb80-103" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_logo_right_offset"</span>,<span class="at">label=</span><span class="st">"Offset"</span>,<span class="at">value=</span><span class="fl">0.02</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="fl">0.2</span>,<span class="at">step=</span><span class="fl">0.01</span>)</span>
<span id="cb80-104"><a href="#cb80-104" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb80-105"><a href="#cb80-105" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">6</span>,<span class="at">style=</span><span class="fu">list</span>(<span class="st">"padding-left: 3px;"</span>),</span>
<span id="cb80-106"><a href="#cb80-106" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">numericInput</span>(<span class="st">"in_logo_right_scale"</span>,<span class="at">label=</span><span class="st">"Width"</span>,<span class="at">value=</span><span class="fl">0.2</span>,<span class="at">min=</span><span class="fl">0.1</span>,<span class="at">max=</span><span class="fl">0.6</span>,<span class="at">step=</span><span class="fl">0.01</span>)</span>
<span id="cb80-107"><a href="#cb80-107" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb80-108"><a href="#cb80-108" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb80-109"><a href="#cb80-109" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb80-110"><a href="#cb80-110" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb80-111"><a href="#cb80-111" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb80-112"><a href="#cb80-112" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-113"><a href="#cb80-113" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb80-114"><a href="#cb80-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-115"><a href="#cb80-115" aria-hidden="true" tabindex="-1"></a>    <span class="do">## FN: fn_input --------------------------------------------------------</span></span>
<span id="cb80-116"><a href="#cb80-116" aria-hidden="true" tabindex="-1"></a>    <span class="do">## function to get input data</span></span>
<span id="cb80-117"><a href="#cb80-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-118"><a href="#cb80-118" aria-hidden="true" tabindex="-1"></a>    fn_input <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb80-119"><a href="#cb80-119" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_input))</span>
<span id="cb80-120"><a href="#cb80-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">try</span>(input<span class="sc">$</span>in_data),<span class="at">message1=</span><span class="st">"Upload a file or paste text."</span>))</span>
<span id="cb80-121"><a href="#cb80-121" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_data_format))</span>
<span id="cb80-122"><a href="#cb80-122" aria-hidden="true" tabindex="-1"></a>      fr <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(input<span class="sc">$</span>in_data_format<span class="sc">==</span><span class="st">"tsv"</span>,<span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,<span class="fu">ifelse</span>(input<span class="sc">$</span>in_data_format<span class="sc">==</span><span class="st">"csv"</span>,<span class="st">","</span>,<span class="st">";"</span>))</span>
<span id="cb80-123"><a href="#cb80-123" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-124"><a href="#cb80-124" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(input<span class="sc">$</span>in_input<span class="sc">==</span><span class="st">"Upload file"</span>) {</span>
<span id="cb80-125"><a href="#cb80-125" aria-hidden="true" tabindex="-1"></a>        dfr <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(input<span class="sc">$</span>in_data<span class="sc">$</span>datapath,<span class="at">header=</span><span class="cn">TRUE</span>,<span class="at">sep=</span>fr,<span class="at">stringsAsFactors=</span>F)</span>
<span id="cb80-126"><a href="#cb80-126" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb80-127"><a href="#cb80-127" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(input<span class="sc">$</span>in_input<span class="sc">==</span><span class="st">"Paste text"</span>) {</span>
<span id="cb80-128"><a href="#cb80-128" aria-hidden="true" tabindex="-1"></a>        df1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(input<span class="sc">$</span>in_data,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))),fr))</span>
<span id="cb80-129"><a href="#cb80-129" aria-hidden="true" tabindex="-1"></a>        cnames <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df1[,<span class="dv">1</span>])</span>
<span id="cb80-130"><a href="#cb80-130" aria-hidden="true" tabindex="-1"></a>        df1[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-131"><a href="#cb80-131" aria-hidden="true" tabindex="-1"></a>        dfr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(df1),<span class="at">stringsAsFactors=</span>F)</span>
<span id="cb80-132"><a href="#cb80-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(dfr) <span class="ot">&lt;-</span> cnames</span>
<span id="cb80-133"><a href="#cb80-133" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rownames</span>(dfr) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dfr)</span>
<span id="cb80-134"><a href="#cb80-134" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb80-135"><a href="#cb80-135" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-136"><a href="#cb80-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(dfr) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(dfr))</span>
<span id="cb80-137"><a href="#cb80-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(dfr)</span>
<span id="cb80-138"><a href="#cb80-138" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb80-139"><a href="#cb80-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-140"><a href="#cb80-140" aria-hidden="true" tabindex="-1"></a>    <span class="do">## FN: fn_params ------------------------------------------------------------</span></span>
<span id="cb80-141"><a href="#cb80-141" aria-hidden="true" tabindex="-1"></a>    <span class="do">## function to get plot params</span></span>
<span id="cb80-142"><a href="#cb80-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-143"><a href="#cb80-143" aria-hidden="true" tabindex="-1"></a>    fn_params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb80-144"><a href="#cb80-144" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-145"><a href="#cb80-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_input</span>()))</span>
<span id="cb80-146"><a href="#cb80-146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_settings))</span>
<span id="cb80-147"><a href="#cb80-147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(input<span class="sc">$</span>in_logo_right))</span>
<span id="cb80-148"><a href="#cb80-148" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-149"><a href="#cb80-149" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="st">"label1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(<span class="fu">fn_input</span>())) {l1 <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}<span class="cf">else</span>{l1 <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb80-150"><a href="#cb80-150" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="st">"label2"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(<span class="fu">fn_input</span>())) {l2 <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}<span class="cf">else</span>{l2 <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb80-151"><a href="#cb80-151" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="st">"label3"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(<span class="fu">fn_input</span>())) {l3 <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}<span class="cf">else</span>{l3 <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb80-152"><a href="#cb80-152" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-153"><a href="#cb80-153" aria-hidden="true" tabindex="-1"></a>      <span class="co"># if values are available, use them, else use defaults</span></span>
<span id="cb80-154"><a href="#cb80-154" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label1_size)){l1s <span class="ot">&lt;-</span> <span class="dv">8</span>}<span class="cf">else</span>{l1s <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label1_size}</span>
<span id="cb80-155"><a href="#cb80-155" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label1_x)){l1x <span class="ot">&lt;-</span> <span class="fl">0.5</span>}<span class="cf">else</span>{l1x <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label1_x}</span>
<span id="cb80-156"><a href="#cb80-156" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label1_y)){l1y <span class="ot">&lt;-</span> <span class="fl">0.54</span>}<span class="cf">else</span>{l1y <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label1_y}</span>
<span id="cb80-157"><a href="#cb80-157" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label2_size)){l2s <span class="ot">&lt;-</span> <span class="fl">6.5</span>}<span class="cf">else</span>{l2s <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label2_size}</span>
<span id="cb80-158"><a href="#cb80-158" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label2_x)){l2x <span class="ot">&lt;-</span> <span class="fl">0.5</span>}<span class="cf">else</span>{l2x <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label2_x}</span>
<span id="cb80-159"><a href="#cb80-159" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label2_y)){l2y <span class="ot">&lt;-</span> <span class="fl">0.37</span>}<span class="cf">else</span>{l2y <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label2_y}</span>
<span id="cb80-160"><a href="#cb80-160" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label3_size)){l3s <span class="ot">&lt;-</span> <span class="dv">6</span>}<span class="cf">else</span>{l3s <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label3_size}</span>
<span id="cb80-161"><a href="#cb80-161" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label3_x)){l3x <span class="ot">&lt;-</span> <span class="fl">0.5</span>}<span class="cf">else</span>{l3x <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label3_x}</span>
<span id="cb80-162"><a href="#cb80-162" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_label3_y)){l3y <span class="ot">&lt;-</span> <span class="fl">0.22</span>}<span class="cf">else</span>{l3y <span class="ot">&lt;-</span> input<span class="sc">$</span>in_label3_y}</span>
<span id="cb80-163"><a href="#cb80-163" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_logo_right_offset)){lro <span class="ot">&lt;-</span> <span class="fl">0.04</span>}<span class="cf">else</span>{lro <span class="ot">&lt;-</span> input<span class="sc">$</span>in_logo_right_offset}</span>
<span id="cb80-164"><a href="#cb80-164" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(input<span class="sc">$</span>in_logo_right_scale)){lrs <span class="ot">&lt;-</span> <span class="fl">0.2</span>}<span class="cf">else</span>{lrs <span class="ot">&lt;-</span> input<span class="sc">$</span>in_logo_right_scale}</span>
<span id="cb80-165"><a href="#cb80-165" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-166"><a href="#cb80-166" aria-hidden="true" tabindex="-1"></a>      <span class="co"># logos</span></span>
<span id="cb80-167"><a href="#cb80-167" aria-hidden="true" tabindex="-1"></a>      lr <span class="ot">=</span> <span class="cf">switch</span>(</span>
<span id="cb80-168"><a href="#cb80-168" aria-hidden="true" tabindex="-1"></a>        input<span class="sc">$</span>in_logo_right,</span>
<span id="cb80-169"><a href="#cb80-169" aria-hidden="true" tabindex="-1"></a>        <span class="st">"None"</span><span class="ot">=</span><span class="cn">NULL</span>,</span>
<span id="cb80-170"><a href="#cb80-170" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NBIS Green"</span><span class="ot">=</span><span class="st">"./www/nbis_200_green.png"</span>,</span>
<span id="cb80-171"><a href="#cb80-171" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NBIS Blue"</span><span class="ot">=</span><span class="st">"./www/nbis_200_blue.png"</span>,</span>
<span id="cb80-172"><a href="#cb80-172" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NBIS Orange"</span><span class="ot">=</span><span class="st">"./www/nbis_200_orange.png"</span>,</span>
<span id="cb80-173"><a href="#cb80-173" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SciLifeLab Green"</span><span class="ot">=</span><span class="st">"./www/scilifelab_200_green.png"</span>,</span>
<span id="cb80-174"><a href="#cb80-174" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SciLifeLab Blue"</span><span class="ot">=</span><span class="st">"./www/scilifelab_200_blue.png"</span>,</span>
<span id="cb80-175"><a href="#cb80-175" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SciLifeLab Orange"</span><span class="ot">=</span><span class="st">"./www/scilifelab_200_orange.png"</span>,</span>
<span id="cb80-176"><a href="#cb80-176" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Elixir"</span><span class="ot">=</span><span class="st">"./www/elixir_200.png"</span></span>
<span id="cb80-177"><a href="#cb80-177" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb80-178"><a href="#cb80-178" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lr)) {lri <span class="ot">&lt;-</span> <span class="fu">readPNG</span>(lr)}<span class="cf">else</span>{lri <span class="ot">&lt;-</span> <span class="cn">NULL</span>}</span>
<span id="cb80-179"><a href="#cb80-179" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-180"><a href="#cb80-180" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">l1s=</span>l1s,<span class="at">l1x=</span>l1x,<span class="at">l1y=</span>l1y,<span class="at">l2s=</span>l2s,<span class="at">l2x=</span>l2x,<span class="at">l2y=</span>l2y,<span class="at">l3s=</span>l3s,<span class="at">l3x=</span>l3x,<span class="at">l3y=</span>l3y,</span>
<span id="cb80-181"><a href="#cb80-181" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lro=</span>lro,<span class="at">lrs=</span>lrs,<span class="at">lri=</span>lri))</span>
<span id="cb80-182"><a href="#cb80-182" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb80-183"><a href="#cb80-183" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-184"><a href="#cb80-184" aria-hidden="true" tabindex="-1"></a>    <span class="do">## OUT: out_plot ------------------------------------------------------------</span></span>
<span id="cb80-185"><a href="#cb80-185" aria-hidden="true" tabindex="-1"></a>    <span class="do">## plots figure</span></span>
<span id="cb80-186"><a href="#cb80-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-187"><a href="#cb80-187" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_plot <span class="ot">&lt;-</span> <span class="fu">renderImage</span>({</span>
<span id="cb80-188"><a href="#cb80-188" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-189"><a href="#cb80-189" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_input</span>()))</span>
<span id="cb80-190"><a href="#cb80-190" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_params</span>()))</span>
<span id="cb80-191"><a href="#cb80-191" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">fn_params</span>()</span>
<span id="cb80-192"><a href="#cb80-192" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-193"><a href="#cb80-193" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nametag</span>(<span class="at">dfr=</span><span class="fu">fn_input</span>(),<span class="at">label1_sz=</span>p<span class="sc">$</span>l1s,<span class="at">label1_x=</span>p<span class="sc">$</span>l1x,<span class="at">label1_y=</span>p<span class="sc">$</span>l1y,</span>
<span id="cb80-194"><a href="#cb80-194" aria-hidden="true" tabindex="-1"></a>              <span class="at">label2_sz=</span>p<span class="sc">$</span>l2s,<span class="at">label2_x=</span>p<span class="sc">$</span>l2x,<span class="at">label2_y=</span>p<span class="sc">$</span>l2y,</span>
<span id="cb80-195"><a href="#cb80-195" aria-hidden="true" tabindex="-1"></a>              <span class="at">label3_sz=</span>p<span class="sc">$</span>l3s,<span class="at">label3_x=</span>p<span class="sc">$</span>l3x,<span class="at">label3_y=</span>p<span class="sc">$</span>l3y,</span>
<span id="cb80-196"><a href="#cb80-196" aria-hidden="true" tabindex="-1"></a>              <span class="at">logo_right=</span>p<span class="sc">$</span>lri,<span class="at">logo_right_offset=</span>p<span class="sc">$</span>lro,<span class="at">logo_right_scale=</span>p<span class="sc">$</span>lrs)</span>
<span id="cb80-197"><a href="#cb80-197" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-198"><a href="#cb80-198" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">src=</span><span class="st">"nametag_1.png"</span>,<span class="at">contentType=</span><span class="st">"image/png"</span>,</span>
<span id="cb80-199"><a href="#cb80-199" aria-hidden="true" tabindex="-1"></a>                  <span class="at">width=</span><span class="fu">round</span>(<span class="dv">9</span><span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="fl">37.7</span><span class="sc">*</span><span class="fl">0.6</span>,<span class="dv">0</span>),</span>
<span id="cb80-200"><a href="#cb80-200" aria-hidden="true" tabindex="-1"></a>                  <span class="at">height=</span><span class="fu">round</span>(<span class="fl">5.5</span><span class="sc">*</span><span class="dv">4</span><span class="sc">*</span><span class="fl">37.7</span><span class="sc">*</span><span class="fl">0.6</span>,<span class="dv">0</span>),</span>
<span id="cb80-201"><a href="#cb80-201" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alt=</span><span class="st">"nametagger_image"</span>))</span>
<span id="cb80-202"><a href="#cb80-202" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb80-203"><a href="#cb80-203" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-204"><a href="#cb80-204" aria-hidden="true" tabindex="-1"></a>    <span class="do">## OUT: out_pagecount -------------------------------------------------------</span></span>
<span id="cb80-205"><a href="#cb80-205" aria-hidden="true" tabindex="-1"></a>    <span class="do">## prints general variables for debugging</span></span>
<span id="cb80-206"><a href="#cb80-206" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-207"><a href="#cb80-207" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out_pagecount <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb80-208"><a href="#cb80-208" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-209"><a href="#cb80-209" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req</span>(<span class="fu">fn_input</span>())</span>
<span id="cb80-210"><a href="#cb80-210" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-211"><a href="#cb80-211" aria-hidden="true" tabindex="-1"></a>      npages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">nrow</span>(<span class="fu">fn_input</span>())<span class="sc">/</span><span class="dv">8</span>)</span>
<span id="cb80-212"><a href="#cb80-212" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"Showing 1 of "</span>,npages,<span class="st">" pages."</span>)</span>
<span id="cb80-213"><a href="#cb80-213" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb80-214"><a href="#cb80-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-215"><a href="#cb80-215" aria-hidden="true" tabindex="-1"></a>    <span class="do">## FN: fn_download -----------------------------------------------------------</span></span>
<span id="cb80-216"><a href="#cb80-216" aria-hidden="true" tabindex="-1"></a>    <span class="do">## function to download a zipped file with images</span></span>
<span id="cb80-217"><a href="#cb80-217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-218"><a href="#cb80-218" aria-hidden="true" tabindex="-1"></a>    fn_download <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb80-219"><a href="#cb80-219" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-220"><a href="#cb80-220" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_input</span>()))</span>
<span id="cb80-221"><a href="#cb80-221" aria-hidden="true" tabindex="-1"></a>      <span class="fu">validate</span>(<span class="fu">fn_validate</span>(<span class="fu">fn_params</span>()))</span>
<span id="cb80-222"><a href="#cb80-222" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-223"><a href="#cb80-223" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">fn_params</span>()</span>
<span id="cb80-224"><a href="#cb80-224" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nametag</span>(<span class="at">dfr=</span><span class="fu">fn_input</span>(),<span class="at">label1_sz=</span>p<span class="sc">$</span>l1s,<span class="at">label1_x=</span>p<span class="sc">$</span>l1x,<span class="at">label1_y=</span>p<span class="sc">$</span>l1y,</span>
<span id="cb80-225"><a href="#cb80-225" aria-hidden="true" tabindex="-1"></a>              <span class="at">label2_sz=</span>p<span class="sc">$</span>l2s,<span class="at">label2_x=</span>p<span class="sc">$</span>l2x,<span class="at">label2_y=</span>p<span class="sc">$</span>l2y,</span>
<span id="cb80-226"><a href="#cb80-226" aria-hidden="true" tabindex="-1"></a>              <span class="at">label3_sz=</span>p<span class="sc">$</span>l3s,<span class="at">label3_x=</span>p<span class="sc">$</span>l3x,<span class="at">label3_y=</span>p<span class="sc">$</span>l3y,</span>
<span id="cb80-227"><a href="#cb80-227" aria-hidden="true" tabindex="-1"></a>              <span class="at">logo_right=</span>p<span class="sc">$</span>lri,<span class="at">logo_right_offset=</span>p<span class="sc">$</span>lro,<span class="at">logo_right_scale=</span>p<span class="sc">$</span>lrs,</span>
<span id="cb80-228"><a href="#cb80-228" aria-hidden="true" tabindex="-1"></a>              <span class="at">path=</span><span class="st">"."</span>)</span>
<span id="cb80-229"><a href="#cb80-229" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-230"><a href="#cb80-230" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlink</span>(<span class="st">"nametagger.zip"</span>)</span>
<span id="cb80-231"><a href="#cb80-231" aria-hidden="true" tabindex="-1"></a>      <span class="fu">zip</span>(<span class="st">"nametagger.zip"</span>,<span class="at">files=</span><span class="fu">list.files</span>()[<span class="fu">grep</span>(<span class="st">"nametag_[0-9]+[.png$|.pdf$]"</span>,<span class="fu">list.files</span>())])</span>
<span id="cb80-232"><a href="#cb80-232" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlink</span>(<span class="fu">list.files</span>()[<span class="fu">grep</span>(<span class="st">"nametag_[0-9]+[.png$|.pdf$]"</span>,<span class="fu">list.files</span>())])</span>
<span id="cb80-233"><a href="#cb80-233" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-234"><a href="#cb80-234" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-235"><a href="#cb80-235" aria-hidden="true" tabindex="-1"></a>    <span class="do">## DHL: btn_download ---------------------------------------------------------</span></span>
<span id="cb80-236"><a href="#cb80-236" aria-hidden="true" tabindex="-1"></a>    <span class="do">## download handler for downloading zipped file</span></span>
<span id="cb80-237"><a href="#cb80-237" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-238"><a href="#cb80-238" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>btn_download <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb80-239"><a href="#cb80-239" aria-hidden="true" tabindex="-1"></a>      <span class="at">filename=</span><span class="st">"nametagger.zip"</span>,</span>
<span id="cb80-240"><a href="#cb80-240" aria-hidden="true" tabindex="-1"></a>      <span class="at">content=</span><span class="cf">function</span>(file) {</span>
<span id="cb80-241"><a href="#cb80-241" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fn_download</span>()</span>
<span id="cb80-242"><a href="#cb80-242" aria-hidden="true" tabindex="-1"></a>        <span class="fu">file.copy</span>(<span class="st">"nametagger.zip"</span>,file,<span class="at">overwrite=</span>T)</span>
<span id="cb80-243"><a href="#cb80-243" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb80-244"><a href="#cb80-244" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb80-245"><a href="#cb80-245" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-246"><a href="#cb80-246" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="assets/nametagger_preview.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="assets/nametagger_preview.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>Hopefully, this has not been too overwhelming. Shiny app code may look over-complicated on the first look, but it is easier to understand what is happening by breaking it apart into smaller chunks and understanding how the various components are connected. It is crucial to plan out the structure of your app well in advanced as it is easy to get confused. Remember to name functions and variables sensibly. Use text output widgets and/or print statements in the code to keep track of internal variable values during run-time. Go forth and build awesome apps!</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">2023 <a href="about.html">NBIS</a> | <a href="https://choosealicense.com/licenses/gpl-3.0/">GPL-3 License</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Published with <a href="https://quarto.org/">Quarto</a> v1.3.340</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","selector":".lightbox","openEffect":"zoom","descPosition":"bottom","loop":true});</script>



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>